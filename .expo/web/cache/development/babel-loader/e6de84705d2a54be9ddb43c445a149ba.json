{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Modal from \"react-native-web/dist/exports/Modal\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport Pressable from \"react-native-web/dist/exports/Pressable\";\nimport RefreshControl from \"react-native-web/dist/exports/RefreshControl\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport TouchableHighlight from \"react-native-web/dist/exports/TouchableHighlight\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport useColorScheme from \"react-native-web/dist/exports/useColorScheme\";\nimport useWindowDimensions from \"react-native-web/dist/exports/useWindowDimensions\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { Component, useEffect, useRef, useState } from \"react\";\nimport * as React from \"react\";\nimport { styles } from \"../css\";\nimport { Portrait } from \"../component/portrait\";\nimport { Btn, TextClick } from \"../component/btn\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { _addStore, _Column, _ImTime, _Listen, _ListId, _Msg, _onColumn, _onListen, _Unread, _User, ip } from \"../_Api\";\nimport { io } from \"socket.io-client\";\nimport { OssImage } from \"../utils/oss\";\nimport { Record } from \"../component/record\";\nimport { memberFun, timeIm } from \"../utils/time\";\nimport KeyboardAvoidingView from \"react-native/Libraries/Components/Keyboard/KeyboardAvoidingView\";\nimport { Audio } from 'expo-av';\nvar socket = io(\"ws://\" + ip + \":3000\");\nvar host = \"http://\" + ip + \":3000/audio/\";\nimport * as Clipboard from 'expo-clipboard';\nimport { msg } from \"@babel/core/lib/config/validation/option-assertions\";\nimport * as Haptics from \"expo-haptics\";\nimport { listNotifications } from \"../utils/notificationsFun\";\nimport * as Notifications from \"expo-notifications\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport function Im(_ref2) {\n  var route = _ref2.route,\n    navigation = _ref2.navigation;\n  var colorScheme = useColorScheme();\n  var list = route.params.list;\n  var C1 = colorScheme == 'light' ? styles.lightC1 : styles.darkC1;\n  var BbC = colorScheme == 'light' ? styles.lightBbC : styles.darkBbC;\n  var MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg;\n  var MstText = colorScheme == 'light' ? {\n    color: '#222222'\n  } : {\n    color: '#ffffff'\n  };\n  var _useState = useState({}),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var userRef = useRef(user);\n  userRef.current = user;\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    member = _useState4[0],\n    setMember = _useState4[1];\n  var _useState5 = useState(''),\n    _useState6 = _slicedToArray(_useState5, 2),\n    input = _useState6[0],\n    setInput = _useState6[1];\n  var _useState7 = useState(),\n    _useState8 = _slicedToArray(_useState7, 2),\n    audioLoad = _useState8[0],\n    setAudioLoad = _useState8[1];\n  var _useState9 = useState(1),\n    _useState10 = _slicedToArray(_useState9, 2),\n    seconds = _useState10[0],\n    setSeconds = _useState10[1];\n  var _useState11 = useState(NaN),\n    _useState12 = _slicedToArray(_useState11, 2),\n    onIm = _useState12[0],\n    setOnIm = _useState12[1];\n  var onImRef = useRef(onIm);\n  onImRef.current = onIm;\n  var _useState13 = useState([]),\n    _useState14 = _slicedToArray(_useState13, 2),\n    columnLi = _useState14[0],\n    setColumnLi = _useState14[1];\n  var columnRef = useRef(columnLi);\n  columnRef.current = columnLi;\n  var _ref = useRef(null);\n  var _useState15 = useState([]),\n    _useState16 = _slicedToArray(_useState15, 2),\n    msgArr = _useState16[0],\n    setMsgArr = _useState16[1];\n  var msgRef = useRef(msgArr);\n  msgRef.current = msgArr;\n  var _useState17 = useState(0),\n    _useState18 = _slicedToArray(_useState17, 2),\n    page = _useState18[0],\n    setPage = _useState18[1];\n  var _useState19 = useState([]),\n    _useState20 = _slicedToArray(_useState19, 2),\n    to = _useState20[0],\n    setTo = _useState20[1];\n  var _useState21 = useState([]),\n    _useState22 = _slicedToArray(_useState21, 2),\n    word = _useState22[0],\n    setWord = _useState22[1];\n  var _interval = useRef();\n  var window = useWindowDimensions();\n  var memberBoolean = function memberBoolean(t) {\n    var now = new Date();\n    var time = new Date(t);\n    if (time > now) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n  useFocusEffect(React.useCallback(function () {\n    _User(function (user) {\n      socket.on(user._id, function () {\n        var _ref3 = _asyncToGenerator(function* (li) {\n          console.log('im接受到其他的信道消息');\n        });\n        return function (_x) {\n          return _ref3.apply(this, arguments);\n        };\n      }());\n      setUser(user);\n      console.log('userIM:', user._id);\n      setMember(true);\n      _ListId(list, function (cb) {\n        if (cb.imTitle) {\n          navigation.setOptions({\n            title: cb.imTitle + (\"(\" + cb.userArr.length + \")\"),\n            headerRight: function headerRight() {\n              return _jsx(Text, {\n                style: [styles.T5, MstText, styles.bold],\n                onPress: function onPress() {\n                  return navigation.navigate('Adds', {\n                    'list': list\n                  });\n                },\n                children: \"\\u7BA1\\u7406\"\n              });\n            }\n          });\n          var arr = [];\n          cb.userArr.map(function (item) {\n            return arr.push(item._id);\n          });\n          setTo(arr);\n        } else {\n          if (cb.userArr[0]._id == user._id) {\n            navigation.setOptions({\n              title: cb.userArr[1].name\n            });\n            setTo([cb.userArr[1]._id]);\n          } else {\n            navigation.setOptions({\n              title: cb.userArr[0].name\n            });\n            setTo([cb.userArr[0]._id]);\n          }\n        }\n      });\n    });\n    _Msg(list, page, function (cd) {\n      console.log('滚动对话、、', cd.length);\n      setMsgArr(cd);\n      cd.length ? setTimeout(function () {\n        return _ref.current.scrollToEnd({\n          animated: true\n        });\n      }, 200) : '';\n    });\n    socket.on(list, function (im) {\n      var arr = msgRef.current;\n      if (im.tIm == 5) {\n        arr.map(function (item, index) {\n          if (im.q == item._id) {\n            console.log('撤回消息', index);\n            arr.splice(index, 1);\n          }\n        });\n        setMsgArr(_toConsumableArray(arr));\n        return;\n      }\n      arr.push(im);\n      setMsgArr(_toConsumableArray(arr));\n      setTimeout(function () {\n        return _ref.current.scrollToEnd({\n          animated: true\n        });\n      }, 100);\n      if (userRef.current.listen && im.tIm == 1 && user._id == im.user._id) {\n        playSound(arr.length - 1, im);\n      }\n      if (!userRef.current.listen) {\n        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);\n      }\n    });\n    return function () {\n      _ImTime(list);\n      socket.off(list);\n      _Unread(list, userRef.current._id);\n    };\n  }, []));\n  var _useState23 = useState(false),\n    _useState24 = _slicedToArray(_useState23, 2),\n    load = _useState24[0],\n    setLoad = _useState24[1];\n  var _React$useState = React.useState(),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    sound = _React$useState2[0],\n    setSound = _React$useState2[1];\n  var playSound = function () {\n    var _ref4 = _asyncToGenerator(function* (i, im) {\n      var audioFun = function () {\n        var _ref5 = _asyncToGenerator(function* (key, url) {\n          setOnIm(key);\n          var _yield$Audio$Sound$cr = yield Audio.Sound.createAsync({\n              uri: url\n            }),\n            sound = _yield$Audio$Sound$cr.sound;\n          setSound(sound);\n          yield sound.playAsync();\n        });\n        return function audioFun(_x4, _x5) {\n          return _ref5.apply(this, arguments);\n        };\n      }();\n      if (im.tIm == 1) {\n        if (im.url == 'null') {\n          _Listen(im._id, im.enQ, function (cb) {\n            console.log('本地跟读', cb.url);\n            var arr = msgRef.current;\n            arr[i].url = cb.url;\n            setMsgArr(arr);\n            audioFun(i, host + cb.url);\n          });\n        } else {\n          console.log('云端跟读', im.url);\n          audioFun(i, host + im.url);\n        }\n      }\n      if (im.tIm == 3) {\n        audioFun(i, im.url);\n      }\n    });\n    return function playSound(_x2, _x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var alertMember = function alertMember(t) {\n    var title = t == 1 ? '词列解锁' : '解锁跟读';\n    var msg = t == 1 ? '提高词汇与语法能力' : '加强听力与口语';\n    Alert.alert(title, msg, [{\n      text: '充值',\n      onPress: function onPress() {\n        return Alert.alert('充值解锁', '这个功能还在开发中、');\n      }\n    }, {\n      text: '激活码',\n      onPress: function onPress() {\n        return navigation.navigate('Ticket');\n      }\n    }, {\n      text: '取消'\n    }]);\n  };\n  var recallFun = function recallFun(im) {\n    var imData = {\n      \"q\": im,\n      \"list\": list,\n      \"tIm\": 5\n    };\n    socket.emit('im', imData);\n    console.log('撤回消息', imData);\n  };\n  useEffect(function () {\n    return sound ? function () {\n      console.log('播放完毕');\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      sound.unloadAsync();\n    } : undefined;\n  }, [sound]);\n  return _jsxs(View, {\n    style: [C1, styles.Im],\n    children: [audioLoad ? _jsx(View, {\n      style: [styles.audioModel, {\n        height: input.length ? window.height : window.height - 300\n      }],\n      children: _jsxs(View, {\n        style: [styles.audioBody],\n        children: [_jsxs(Text, {\n          style: [styles.T1, {\n            fontWeight: '600',\n            color: \"#fff\"\n          }],\n          children: [seconds, \" \\\"\"]\n        }), _jsx(Text, {\n          style: [styles.T5, styles.bold, styles.Send, {\n            marginTop: 5,\n            color: \"#fff\"\n          }],\n          children: \"\\u677E\\u624B\\u5373\\u53EF\\u53D1\\u9001\"\n        })]\n      })\n    }) : '', _jsx(Modal, {\n      visible: Boolean(word.length),\n      onRequestClose: function onRequestClose() {\n        return setWord([]);\n      },\n      transparent: true,\n      presentationStyle: 'overFullScreen',\n      animationType: \"slide\",\n      children: _jsxs(View, {\n        style: [styles.Word],\n        children: [_jsx(Text, {\n          style: [styles.T4, styles.WordBtn],\n          onPress: function onPress() {\n            return setWord([]);\n          },\n          children: \"\\u274C\"\n        }), _jsx(View, {\n          style: [styles.Words, C1],\n          children: word.map(function (item, index) {\n            return _jsxs(TouchableOpacity, {\n              children: [_jsxs(Text, {\n                style: [styles.T5, styles.bold, {\n                  marginTop: 5,\n                  marginBottom: 10\n                }, MstText],\n                children: [item.key, \" \"]\n              }), item.value.map(function (items, i) {\n                return _jsx(View, {\n                  children: _jsxs(Text, {\n                    style: [styles.T5, MstText, {\n                      marginBottom: 10,\n                      opacity: 0.8\n                    }],\n                    children: [items, \" \"]\n                  })\n                }, 'wodrs' + i);\n              }), _jsx(View, {\n                style: [BbC, styles.listBbC]\n              })]\n            }, 'wodr' + index);\n          })\n        })]\n      })\n    }), _jsx(SafeAreaView, {\n      style: styles.container,\n      children: _jsx(FlatList, {\n        ref: _ref,\n        refreshing: load,\n        onRefresh: function onRefresh() {\n          setLoad(true);\n          var arr = msgRef.current;\n          console.log('下拉刷新', page);\n          _Msg(list, page + 1, function (cd) {\n            Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n            if (cd.length) {\n              setPage(page + 1);\n              setMsgArr(cd.concat(arr));\n              setTimeout(function () {\n                _ref.current.scrollToIndex({\n                  animated: false,\n                  index: cd.length\n                });\n                setLoad(false);\n              }, 360);\n            }\n          });\n        },\n        data: msgArr,\n        renderItem: function renderItem(_ref6) {\n          var item = _ref6.item,\n            index = _ref6.index;\n          return item.user._id == user._id ? _jsx(View, {\n            children: _jsx(RightMsg, {\n              i: index,\n              onIm: onIm,\n              onSound: function onSound(i, im) {\n                return playSound(i, im);\n              },\n              omWord: function omWord(cd) {\n                return setWord(cd);\n              },\n              onRecall: function onRecall(im) {\n                return recallFun(im);\n              },\n              data: item\n            })\n          }, 'msg' + index) : _jsxs(View, {\n            style: styles.ImMsg,\n            children: [item.tIm != 4 ? _jsx(Portrait, {\n              w: 32,\n              h: 32,\n              r: 7,\n              t: item.user.emoji,\n              url: item.user.avatar\n            }) : '', _jsx(LeftMsg, {\n              i: index,\n              onIm: onIm,\n              omWord: function omWord(cd) {\n                return setWord(cd);\n              },\n              onRecall: function onRecall(im) {\n                return recallFun(im);\n              },\n              onSound: function onSound(i, im) {\n                return playSound(i, im);\n              },\n              data: item\n            })]\n          }, 'msg' + index);\n        },\n        keyExtractor: function keyExtractor(item) {\n          return item._id;\n        },\n        ListFooterComponent: function ListFooterComponent() {\n          return Platform.OS == 'android' ? _jsx(View, {\n            style: {\n              height: 40\n            }\n          }) : _jsx(View, {\n            style: {\n              height: 10\n            }\n          });\n        }\n      })\n    }), _jsxs(View, {\n      style: [styles.imSend],\n      children: [_jsxs(View, {\n        style: styles.imFun,\n        children: [_jsx(View, {\n          style: user.column ? '' : {\n            opacity: 0.3\n          },\n          children: _jsx(Btn, {\n            text: '✍️',\n            fs: 16,\n            press: function press() {\n              return member ? _onColumn(!userRef.current.column, function (user) {\n                setUser(user);\n                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n              }) : alertMember('1');\n            }\n          })\n        }), _jsx(View, {\n          style: user.listen ? '' : {\n            opacity: 0.3\n          },\n          children: _jsx(Btn, {\n            text: '🎧️️',\n            fs: 16,\n            press: function press() {\n              return member ? _onListen(!userRef.current.listen, function (user) {\n                setUser(user);\n                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n              }) : alertMember('2');\n            }\n          })\n        })]\n      }), _jsx(View, {\n        style: styles.imWord,\n        children: columnLi.map(function (item, index) {\n          return _jsxs(Text, {\n            style: styles.imWords,\n            children: [\" \", item, \" \"]\n          }, 'iw' + index);\n        })\n      }), _jsxs(View, {\n        style: [styles.imInput, C1, {\n          paddingLeft: 10,\n          paddingRight: 10\n        }],\n        children: [_jsx(OssImage, {\n          userID: user._id,\n          cb: function cb(url) {\n            var imData = {\n              \"user\": user._id,\n              \"list\": list,\n              \"to\": to,\n              \"url\": url,\n              \"tIm\": 2\n            };\n            socket.emit('im', imData);\n          }\n        }), _jsx(TextInput, {\n          value: input,\n          multiline: true,\n          style: [styles.imInputSend, styles.T5, MsgColor, MstText],\n          onFocus: function onFocus(_ref7) {\n            var target = _ref7.nativeEvent.target;\n            _ref.current.scrollToEnd({\n              animated: true\n            });\n          },\n          onTextInput: function onTextInput(_ref8) {\n            var _ref8$nativeEvent = _ref8.nativeEvent,\n              text = _ref8$nativeEvent.text,\n              previousText = _ref8$nativeEvent.previousText,\n              _ref8$nativeEvent$ran = _ref8$nativeEvent.range,\n              start = _ref8$nativeEvent$ran.start,\n              end = _ref8$nativeEvent$ran.end;\n            var reg = /[^\\u0000-\\u00FF]/;\n            if (reg.test(text.trim()) && user.column) {\n              console.log('词列', text);\n              _Column(text, function (cb) {\n                var columnArr = columnRef.current;\n                columnArr.push(cb);\n                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n                setColumnLi(_toConsumableArray(columnArr));\n              });\n            }\n            if (start == 0) {\n              console.log('重置词列');\n              setColumnLi([].concat());\n            }\n          },\n          onChangeText: function onChangeText(text) {\n            return setInput(text);\n          }\n        }), input.length ? _jsx(TouchableOpacity, {\n          onPress: function onPress() {\n            setInput('');\n            var imData = {\n              \"user\": user._id,\n              \"list\": list,\n              \"to\": to,\n              \"listen\": user.listen ? true : false,\n              \"q\": input,\n              \"tIm\": 1\n            };\n            socket.emit('im', imData);\n          },\n          children: _jsx(Text, {\n            style: styles.imSendBtn,\n            children: \"\\u53D1\\u9001\"\n          })\n        }) : _jsx(Record, {\n          userID: user._id,\n          start: function start() {\n            setAudioLoad(true);\n            _interval.current = setInterval(function () {\n              setSeconds(function (seconds) {\n                return seconds + 1;\n              });\n            }, 1000);\n          },\n          stop: function stop(ell) {\n            setAudioLoad(false);\n            setSeconds(1);\n            clearInterval(_interval.current);\n          },\n          cb: function cb(url) {\n            var imData = {\n              \"user\": user._id,\n              \"list\": list,\n              \"to\": to,\n              \"url\": url,\n              \"q\": seconds,\n              \"tIm\": 3\n            };\n            socket.emit('im', imData);\n          }\n        })]\n      })]\n    })]\n  });\n}\nfunction LeftMsg(props) {\n  var onIm = props.onIm,\n    onSound = props.onSound,\n    data = props.data,\n    i = props.i,\n    omWord = props.omWord,\n    onRecall = props.onRecall;\n  var colorScheme = useColorScheme();\n  var MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg;\n  var MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52';\n  var MstText = colorScheme == 'light' ? {\n    color: '#222222'\n  } : {\n    color: '#ffffff'\n  };\n  var lightNsgBcB = colorScheme == 'light' ? styles.lightNsgBcB : styles.darkNsgBcB;\n  var window = useWindowDimensions();\n  var _useState25 = useState(false),\n    _useState26 = _slicedToArray(_useState25, 2),\n    show = _useState26[0],\n    setShow = _useState26[1];\n  switch (data.tIm) {\n    case 1:\n      return _jsxs(View, {\n        style: [styles.msgRow],\n        children: [_jsxs(View, {\n          style: [{\n            flexDirection: \"row\",\n            alignItems: \"center\"\n          }],\n          children: [_jsxs(TouchableOpacity, {\n            style: [styles.msgText, {\n              maxWidth: 0.6 * window.width\n            }, MsgColor],\n            onPress: function onPress() {\n              return onSound(i, data);\n            },\n            onLongPress: function onLongPress() {\n              setShow(true);\n              setTimeout(function () {\n                setShow(false);\n              }, 3000);\n            },\n            children: [_jsx(Text, {\n              style: [styles.T5, MstText, styles.en, {\n                opacity: 0.8\n              }],\n              children: data.q\n            }), _jsx(Text, {\n              style: [styles.T6, MstText, styles.en, {\n                opacity: 0.8\n              }],\n              children: data.enQ\n            })]\n          }), i == onIm ? _jsx(TouchableHighlight, {\n            activeOpacity: 0.3,\n            underlayColor: MsgColorTouchable,\n            children: _jsx(Text, {\n              style: [styles.msgAudio, styles.T6],\n              children: \" \\uD83C\\uDFB5\"\n            })\n          }) : '']\n        }), show ? _jsxs(View, {\n          style: [styles.flot, MsgColor],\n          children: [data.word.length ? _jsx(TouchableOpacity, {\n            onPress: function onPress() {\n              return omWord(data.word);\n            },\n            children: _jsx(Text, {\n              style: [MstText, styles.flotText],\n              children: \" \\u8BCD\\u5178 \"\n            })\n          }) : '', data.word.length ? _jsx(View, {\n            style: [styles.flotHx, lightNsgBcB]\n          }) : '', _jsx(TouchableOpacity, {\n            onPress: function onPress() {\n              _addStore({\n                url: data.url,\n                tIm: 1,\n                word: data.word,\n                user: data.user._id,\n                q: data.q,\n                enQ: data.enQ\n              });\n              setShow(false);\n            },\n            children: _jsx(Text, {\n              style: [styles.flotText, MstText],\n              children: \"\\u6536\\u85CF \"\n            })\n          }), _jsx(View, {\n            style: [styles.flotHx, lightNsgBcB]\n          }), _jsx(TouchableOpacity, {\n            onPress: _asyncToGenerator(function* () {\n              yield Clipboard.setStringAsync(data.enQ);\n              setShow(false);\n            }),\n            children: _jsx(Text, {\n              style: [styles.flotText, MstText],\n              children: \"\\u590D\\u5236\\u8BD1\\u6587\"\n            })\n          })]\n        }) : '']\n      });\n      break;\n    case 2:\n      return _jsx(TouchableHighlight, {\n        style: [styles.msgRow],\n        children: _jsx(MsgImg, {\n          url: data.url\n        })\n      });\n      break;\n    case 3:\n      return _jsxs(View, {\n        style: [styles.msgRow, {\n          flexDirection: \"row\",\n          alignItems: \"center\"\n        }],\n        children: [_jsx(TouchableOpacity, {\n          style: [styles.msgText, {\n            width: data.q < 20 ? 20 + data.q * 10 : 100\n          }, MsgColor],\n          onPress: function onPress() {\n            return onSound(i, data);\n          },\n          children: _jsxs(Text, {\n            style: [styles.T5, MstText, styles.en, {\n              opacity: 0.8\n            }],\n            children: [data.q, \" \\\"\"]\n          })\n        }), i == onIm ? _jsx(Text, {\n          style: [styles.msgAudio, styles.T6],\n          children: \" \\uD83C\\uDFB5\"\n        }) : '']\n      });\n      break;\n    case 4:\n      return _jsx(Text, {\n        style: [styles.time, MstText, {\n          width: window.width,\n          opacity: 0.3\n        }],\n        children: timeIm(data.q)\n      });\n      break;\n  }\n}\nfunction RightMsg(props) {\n  var onIm = props.onIm,\n    data = props.data,\n    i = props.i,\n    onSound = props.onSound,\n    omWord = props.omWord,\n    onRecall = props.onRecall;\n  var colorScheme = useColorScheme();\n  var MstText = colorScheme == 'light' ? {\n    color: '#222222'\n  } : {\n    color: '#ffffff'\n  };\n  var MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52';\n  var lightNsgBcB = colorScheme == 'light' ? styles.lightNsgBcB : styles.darkNsgBcB;\n  var window = useWindowDimensions();\n  var _useState27 = useState(false),\n    _useState28 = _slicedToArray(_useState27, 2),\n    show = _useState28[0],\n    setShow = _useState28[1];\n  switch (data.tIm) {\n    case 1:\n      return _jsxs(View, {\n        style: [styles.msgRowRight],\n        children: [_jsxs(View, {\n          style: [{\n            flexDirection: \"row\",\n            alignItems: \"center\"\n          }],\n          children: [i == onIm ? _jsx(TouchableHighlight, {\n            children: _jsx(Text, {\n              style: [styles.msgAudio, styles.T6],\n              children: \" \\uD83C\\uDFB5\"\n            })\n          }) : '', _jsxs(TouchableOpacity, {\n            style: [styles.msgText, {\n              backgroundColor: '#5A8DFF',\n              maxWidth: 0.6 * window.width\n            }],\n            onPress: function onPress() {\n              return onSound(i, data);\n            },\n            onLongPress: function onLongPress() {\n              setShow(true);\n              setTimeout(function () {\n                setShow(false);\n              }, 3000);\n            },\n            children: [_jsx(Text, {\n              style: [styles.T5, {\n                color: \"#fff\"\n              }],\n              children: data.q\n            }), _jsx(Text, {\n              style: [styles.T6, styles.en, {\n                color: \"#fff\"\n              }, {\n                opacity: 0.8\n              }],\n              children: data.enQ\n            })]\n          })]\n        }), show ? _jsxs(View, {\n          style: [styles.flot, {\n            backgroundColor: '#5A8DFF'\n          }],\n          children: [data.word.length ? _jsx(TouchableOpacity, {\n            onPress: function onPress() {\n              return omWord(data.word);\n            },\n            children: _jsx(Text, {\n              style: [{\n                color: \"#fff\"\n              }, styles.flotText],\n              children: \" \\u8BCD\\u5178 \"\n            })\n          }) : '', data.word.length ? _jsx(View, {\n            style: [styles.flotHx, {\n              backgroundColor: '#EAEAEA'\n            }]\n          }) : \"\", _jsx(TouchableOpacity, {\n            onPress: function onPress() {\n              _addStore({\n                url: data.url,\n                tIm: 1,\n                word: data.word,\n                user: data.user._id,\n                q: data.q,\n                enQ: data.enQ\n              });\n              setShow(false);\n            },\n            children: _jsx(Text, {\n              style: [{\n                color: \"#fff\"\n              }, styles.flotText],\n              children: \" \\u6536\\u85CF \"\n            })\n          }), _jsx(View, {\n            style: [styles.flotHx, {\n              backgroundColor: '#EAEAEA'\n            }]\n          }), _jsx(TouchableOpacity, {\n            onPress: _asyncToGenerator(function* () {\n              yield Clipboard.setStringAsync(data.enQ);\n              setShow(false);\n            }),\n            children: _jsx(Text, {\n              style: [{\n                color: \"#fff\"\n              }, styles.flotText],\n              children: \" \\u590D\\u5236\\u8BD1\\u6587\"\n            })\n          }), _jsx(View, {\n            style: [styles.flotHx, {\n              backgroundColor: '#EAEAEA'\n            }]\n          }), _jsx(TouchableOpacity, {\n            onPress: function onPress() {\n              return Alert.alert('撤回消息', '一旦撤回将永不可见', [{\n                text: '确定',\n                onPress: function onPress() {\n                  return onRecall(data._id);\n                }\n              }, {\n                text: '取消',\n                onPress: function onPress() {\n                  return setShow(false);\n                }\n              }]);\n            },\n            children: _jsx(Text, {\n              style: [{\n                color: \"#fff\"\n              }, styles.flotText],\n              children: \" \\u64A4\\u56DE \"\n            })\n          })]\n        }) : '']\n      });\n      break;\n    case 2:\n      return _jsx(View, {\n        style: [styles.msgRowRight],\n        children: _jsx(TouchableHighlight, {\n          onLongPress: function onLongPress() {\n            return Alert.alert('撤回这张图片', '消息撤回后，将不可见', [{\n              text: \"确定\",\n              onPress: function onPress() {\n                return onRecall(data._id);\n              }\n            }, {\n              text: \"取消\"\n            }]);\n          },\n          children: _jsx(MsgImg, {\n            url: data.url\n          })\n        })\n      });\n      break;\n    case 3:\n      return _jsxs(View, {\n        style: [styles.msgRowRight, {\n          flexDirection: \"row\",\n          alignItems: \"center\"\n        }],\n        children: [i == onIm ? _jsx(Text, {\n          style: [styles.msgAudio, styles.T6],\n          children: \" \\uD83C\\uDFB5\"\n        }) : '', _jsx(TouchableOpacity, {\n          style: [styles.msgText, {\n            backgroundColor: '#5A8DFF',\n            width: data.q < 20 ? 20 + data.q * 10 : 100\n          }],\n          onPress: function onPress() {\n            return onSound(i, data);\n          },\n          onLongPress: function onLongPress() {\n            return Alert.alert('撤回语音', '消息撤回后，将不可见', [{\n              text: \"确定\",\n              onPress: function onPress() {\n                return onRecall(data._id);\n              }\n            }, {\n              text: \"取消\"\n            }]);\n          },\n          children: _jsxs(Text, {\n            style: [styles.T5, styles.en, {\n              color: \"#fff\",\n              opacity: 0.8,\n              width: data.q < 20 ? 20 + data.q * 10 : 100\n            }],\n            children: [\" \", data.q, \" \\\"\"]\n          })\n        })]\n      });\n      break;\n    case 4:\n      return _jsx(Text, {\n        style: [styles.time, MstText, {\n          width: window.width,\n          opacity: 0.3\n        }],\n        children: timeIm(data.q)\n      });\n      break;\n  }\n}\nfunction MsgImg(props) {\n  var _useState29 = useState(200),\n    _useState30 = _slicedToArray(_useState29, 2),\n    w = _useState30[0],\n    setW = _useState30[1];\n  var _useState31 = useState(200),\n    _useState32 = _slicedToArray(_useState31, 2),\n    h = _useState32[0],\n    setH = _useState32[1];\n  var window = useWindowDimensions();\n  useEffect(function () {\n    Image.getSize(props.url, function (w, h) {\n      var maxWidth = window.width * 0.7;\n      if (window.width < w) {\n        setH(h * (maxWidth / w));\n        setW(maxWidth);\n      } else {\n        setH(h);\n        setW(w);\n      }\n    });\n  }, []);\n  return _jsx(Image, {\n    style: [{\n      width: w,\n      height: h,\n      borderRadius: 5\n    }],\n    source: {\n      uri: props.url\n    }\n  });\n}","map":{"version":3,"names":["Component","useEffect","useRef","useState","React","styles","Portrait","Btn","TextClick","useFocusEffect","_addStore","_Column","_ImTime","_Listen","_ListId","_Msg","_onColumn","_onListen","_Unread","_User","ip","io","OssImage","Record","memberFun","timeIm","KeyboardAvoidingView","Audio","socket","host","Clipboard","msg","Haptics","listNotifications","Notifications","Im","route","navigation","colorScheme","useColorScheme","list","params","C1","lightC1","darkC1","BbC","lightBbC","darkBbC","MsgColor","lightMsg","darkMsg","MstText","color","user","setUser","userRef","current","member","setMember","input","setInput","audioLoad","setAudioLoad","seconds","setSeconds","NaN","onIm","setOnIm","onImRef","columnLi","setColumnLi","columnRef","_ref","msgArr","setMsgArr","msgRef","page","setPage","to","setTo","word","setWord","_interval","window","useWindowDimensions","memberBoolean","t","now","Date","time","useCallback","on","_id","li","console","log","cb","imTitle","setOptions","title","userArr","length","headerRight","T5","bold","navigate","arr","map","item","push","name","cd","setTimeout","scrollToEnd","animated","im","tIm","index","q","splice","listen","playSound","impactAsync","ImpactFeedbackStyle","Heavy","off","load","setLoad","sound","setSound","i","audioFun","key","url","Sound","createAsync","uri","playAsync","enQ","alertMember","Alert","alert","text","onPress","recallFun","imData","emit","Light","unloadAsync","undefined","audioModel","height","audioBody","T1","fontWeight","Send","marginTop","Boolean","Word","T4","WordBtn","Words","marginBottom","value","items","opacity","listBbC","container","Medium","concat","scrollToIndex","ImMsg","emoji","avatar","Platform","OS","imSend","imFun","column","imWord","imWords","imInput","paddingLeft","paddingRight","imInputSend","target","nativeEvent","previousText","range","start","end","reg","test","trim","columnArr","imSendBtn","setInterval","ell","clearInterval","LeftMsg","props","onSound","data","omWord","onRecall","MsgColorTouchable","lightNsgBcB","darkNsgBcB","show","setShow","msgRow","flexDirection","alignItems","msgText","maxWidth","width","en","T6","msgAudio","flot","flotText","flotHx","setStringAsync","RightMsg","msgRowRight","backgroundColor","MsgImg","w","setW","h","setH","Image","getSize","borderRadius"],"sources":["/Users/hez/code/boatApp/src/views/im.js"],"sourcesContent":["import {\n    ActivityIndicator, Alert,\n    Button, FlatList,\n    Image, Modal, Platform, Pressable, RefreshControl,\n    SafeAreaView,\n    ScrollView,\n    Text,\n    TextInput,\n    TouchableHighlight, TouchableOpacity,\n    useColorScheme,\n    useWindowDimensions,\n    View\n} from \"react-native\";\nimport {Component, useEffect, useRef, useState} from \"react\";\nimport * as React from \"react\";\nimport {styles} from \"../css\";\nimport {Portrait} from \"../component/portrait\";\nimport {Btn, TextClick} from \"../component/btn\";\nimport {useFocusEffect} from \"@react-navigation/native\";\nimport {_addStore, _Column, _ImTime, _Listen, _ListId, _Msg, _onColumn, _onListen, _Unread, _User, ip} from \"../_Api\";\nimport {io} from \"socket.io-client\";\nimport {OssImage} from \"../utils/oss\";\nimport {Record} from \"../component/record\";\nimport {memberFun, timeIm} from \"../utils/time\";\nimport KeyboardAvoidingView from \"react-native/Libraries/Components/Keyboard/KeyboardAvoidingView\";\nimport {Audio} from 'expo-av';\n\nconst socket = io(`ws://${ip}:3000`)\nconst host = `http://${ip}:3000/audio/`\nimport * as Clipboard from 'expo-clipboard'\nimport {msg} from \"@babel/core/lib/config/validation/option-assertions\";\nimport * as Haptics from \"expo-haptics\";\nimport {listNotifications} from \"../utils/notificationsFun\";\nimport * as Notifications from \"expo-notifications\";\n\nexport function Im({route, navigation}) {\n    const colorScheme = useColorScheme();\n    // 路由参数\n    const {list} = route.params;\n\n    const C1 = colorScheme == 'light' ? styles.lightC1 : styles.darkC1\n    const BbC = colorScheme == 'light' ? styles.lightBbC : styles.darkBbC\n    const MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg  //对话框配色\n    const MstText = colorScheme == 'light' ? {color: '#222222'} : {color: '#ffffff'}    //对话框颜色\n\n    const [user, setUser] = useState({}) //用户信息\n    const userRef = useRef(user)\n    userRef.current = user\n\n    const [member, setMember] = useState(false)  //会员到期\n\n    const [input, setInput] = useState('')  //输入信息\n    const [audioLoad, setAudioLoad] = useState()  //录制声音\n    const [seconds, setSeconds] = useState(1)   //计时时长\n\n    const [onIm, setOnIm] = useState(NaN)     //选中项目\n    const onImRef = useRef(onIm)\n    onImRef.current = onIm\n\n    const [columnLi, setColumnLi] = useState([]) //词列\n    const columnRef = useRef(columnLi)\n    columnRef.current = columnLi\n\n    const _ref = useRef(null)           //ScrollView 控制器\n\n    const [msgArr, setMsgArr] = useState([])        //对话列表\n    const msgRef = useRef(msgArr)\n    msgRef.current = msgArr\n\n    const [page, setPage] = useState(0)      //页码\n\n    const [to, setTo] = useState([])     //收信人\n    const [word, setWord] = useState([])     //词典\n    const _interval = useRef()  //计时器\n    const window = useWindowDimensions();\n\n    //会员到期时间判定\n    const memberBoolean = (t) => {\n        let now = new Date();\n        let time = new Date(t)\n        if (time > now) {\n            return true\n        } else {\n            return false\n        }\n    }\n\n    // 路由生命周期\n    useFocusEffect(React.useCallback(() => {\n        //获取用户信息\n        _User(user => {\n\n            socket.on(user._id,async li => {\n                console.log('im接受到其他的信道消息',)\n            })\n\n                //获取信道信息\n            setUser(user)\n            console.log('userIM:',user._id)\n            setMember(true)   //功能解锁\n            _ListId(list, cb => {\n                // console.log('信道内容',cb,user)\n                if (cb.imTitle) {\n                    navigation.setOptions({\n                        title: cb.imTitle + `(${cb.userArr.length})`,\n                        headerRight: () => <Text style={[styles.T5, MstText, styles.bold,]}\n                                                 onPress={() => navigation.navigate('Adds', {'list': list})}\n                        >管理</Text>\n                    })\n                    let arr = []\n                    cb.userArr.map(item => arr.push(item._id))\n                    setTo(arr)      //群发对象\n                } else {\n                    if (cb.userArr[0]._id == user._id) {\n                        navigation.setOptions({title: cb.userArr[1].name})\n                        setTo([cb.userArr[1]._id])\n                    } else {\n                        navigation.setOptions({title: cb.userArr[0].name})\n                        setTo([cb.userArr[0]._id])\n                    }\n                }\n            })\n\n        })\n\n\n        // 加载对话内容\n        _Msg(list, page, cd => {\n            console.log('滚动对话、、', cd.length)\n            setMsgArr(cd)\n            cd.length ? setTimeout(() => _ref.current.scrollToEnd({animated: true}), 200) : ''\n        })\n\n        // 接收会话信息\n        socket.on(list, (im) => {\n            let arr = msgRef.current\n            //撤回消息同志\n            if (im.tIm == 5) {\n                arr.map((item, index) => {\n                    if (im.q == item._id) {\n                        console.log('撤回消息', index)\n                        arr.splice(index, 1)\n                    }\n                })\n                setMsgArr([...arr])\n                return\n            }\n\n            arr.push(im)\n            setMsgArr([...arr])\n            setTimeout(() => _ref.current.scrollToEnd({animated: true}), 100)\n            //跟读信号\n            // console.log('跟读',im)\n            if (userRef.current.listen && im.tIm == 1&& user._id== im.user._id) {\n                playSound(arr.length - 1, im)\n            }\n            if(!userRef.current.listen){\n                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy)\n            }\n        });\n\n\n\n        return () => {\n            _ImTime(list) // 更新时间戳\n            socket.off(list)// 断开链接\n            _Unread(list, userRef.current._id) //清除未读\n\n        }\n    }, []))\n\n    //下啦刷新\n    const [load, setLoad] = useState(false)\n\n\n    //播放声音\n    const [sound, setSound] = React.useState();\n    const playSound = async (i, im) => {\n        const audioFun = async (key, url) => {\n            setOnIm(key)\n            const {sound} = await Audio.Sound.createAsync({uri: url});\n            setSound(sound);\n            await sound.playAsync();\n        }\n\n        if (im.tIm == 1) {\n            if (im.url == 'null') {\n                _Listen(im._id, im.enQ, cb => {\n                    console.log('本地跟读', cb.url)\n                    let arr = msgRef.current\n                    arr[i].url = cb.url\n                    setMsgArr(arr)\n                    audioFun(i, host + cb.url)\n                })\n            } else {\n                console.log('云端跟读', im.url)\n                audioFun(i, host + im.url)\n            }\n        }\n\n        //播放语音\n        if (im.tIm == 3) {\n            audioFun(i, im.url)\n        }\n    }\n\n    //解锁提示\n    const alertMember = (t) => {\n        let title = t == 1 ? '词列解锁' : '解锁跟读'\n        let msg = t == 1 ? '提高词汇与语法能力' : '加强听力与口语'\n        Alert.alert(title, msg, [\n            {\n                text: '充值',\n                onPress: () => Alert.alert('充值解锁', '这个功能还在开发中、')\n            },\n            {\n                text: '激活码',\n                onPress: () => navigation.navigate('Ticket')\n            },\n            {\n                text: '取消'\n            }\n        ])\n    }\n\n    //消息撤回\n    const recallFun = (im) => {\n        let imData = {\n            \"q\": im,\n            \"list\": list,\n            \"tIm\": 5\n        }\n        socket.emit('im', imData)\n        console.log('撤回消息', imData)\n    }\n\n    //更新播放器\n    useEffect(() => {\n        return sound\n            ? () => {\n                console.log('播放完毕');\n                Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)\n                sound.unloadAsync();\n            }\n            : undefined;\n    }, [sound])\n\n\n    return <View style={[C1, styles.Im]}>\n        {/*录音推送*/}\n        {audioLoad ? <View style={[styles.audioModel, {height: input.length ? window.height : window.height - 300}]}>\n            <View style={[styles.audioBody]}>\n                <Text style={[styles.T1, {fontWeight: '600', color: \"#fff\"}]}>{seconds} \"</Text>\n                <Text style={[styles.T5, styles.bold, styles.Send, {marginTop: 5, color: \"#fff\"}]}>松手即可发送</Text>\n            </View>\n        </View> : ''}\n\n        {/*词典*/}\n        <Modal\n            visible={Boolean(word.length)}\n            onRequestClose={() => setWord([])}\n            transparent={true}\n            presentationStyle={'overFullScreen'}\n            animationType=\"slide\">\n            <View style={[styles.Word]}>\n                <Text style={[styles.T4, styles.WordBtn]} onPress={() => setWord([])}>❌</Text>\n                <View style={[styles.Words, C1]}>\n                    {word.map((item, index) => <TouchableOpacity key={'wodr' + index}>\n                        <Text style={[styles.T5, styles.bold, {\n                            marginTop: 5,\n                            marginBottom: 10\n                        }, MstText]}>{item.key} </Text>\n                        {item.value.map((items, i) => <View key={'wodrs' + i}>\n                            <Text style={[styles.T5, MstText, {marginBottom: 10, opacity: 0.8}]}>{items} </Text>\n                        </View>)}\n                        <View style={[BbC, styles.listBbC]}></View>\n                    </TouchableOpacity>)}\n                </View>\n            </View>\n        </Modal>\n\n\n        <SafeAreaView style={styles.container}>\n            <FlatList\n                ref={_ref}\n                refreshing={load}\n                onRefresh={()=>{\n                    setLoad(true)\n                    let arr = msgRef.current\n                    console.log('下拉刷新', page)\n                    _Msg(list, page + 1, cd => {\n                        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium)\n\n                        if (cd.length) {\n                            setPage(page + 1)\n                            setMsgArr(cd.concat(arr))\n\n                            setTimeout(()=>{\n                                _ref.current.scrollToIndex({animated:false,index:cd.length})\n                                setLoad(false)\n                            },360)\n                        }\n                    })\n                }}\n                data={msgArr}\n                renderItem={({item,index})=>item.user._id == user._id ?\n                    // 自己发送\n                    <View key={'msg' + index}>\n                        <RightMsg i={index}\n                                  onIm={onIm}   //选中im\n                                  onSound={(i, im) => playSound(i, im)}     //播放译文\n                                  omWord={(cd) => setWord(cd)}        //点击词典\n                                  onRecall={(im) => recallFun(im)}   //撤回消息\n                                  data={item}/>\n                    </View> :\n                    // 别人的\n                    <View style={styles.ImMsg} key={'msg' + index}>\n                        {item.tIm != 4 ? <Portrait w={32} h={32} r={7} t={item.user.emoji} url={item.user.avatar}/> : ''}\n                        <LeftMsg i={index}\n                                 onIm={onIm}   //被选中im\n                                 omWord={(cd) => setWord(cd)}        //点击词典\n                                 onRecall={(im) => recallFun(im)}   //撤回消息\n                                 onSound={(i, im) => playSound(i, im)}\n                                 data={item}/>\n                    </View>}\n                keyExtractor={item => item._id}\n                ListFooterComponent={()=>Platform.OS=='android'?<View style={{height:40}}></View>:<View style={{height:10}}></View>}\n            />\n        </SafeAreaView>\n\n        {/*对话内容*/}\n        {/*<ScrollView*/}\n        {/*    style={styles.ims}*/}\n        {/*    refreshing={true}*/}\n        {/*    refreshControl={<RefreshControl refreshing={load} onRefresh={onRefresh}/>}*/}\n        {/*    keyboardDismissMode={\"on-drag\"}*/}\n        {/*    ref={_ref}>*/}\n        {/*    {msgArr.map((item, index) => item.user._id == user._id ?*/}\n        {/*        // 自己发送*/}\n        {/*        <View key={'msg' + index}>*/}\n        {/*            <RightMsg i={index}*/}\n        {/*                      onIm={onIm}   //选中im*/}\n        {/*                      onSound={(i, im) => playSound(i, im)}     //播放译文*/}\n        {/*                      omWord={(cd) => setWord(cd)}        //点击词典*/}\n        {/*                      onRecall={(im) => recallFun(im)}   //撤回消息*/}\n        {/*                      data={item}/>*/}\n        {/*        </View> :*/}\n        {/*        // 别人的*/}\n        {/*        <View style={styles.ImMsg} key={'msg' + index}>*/}\n        {/*            {item.tIm != 4 ? <Portrait w={32} h={32} r={7} t={item.user.emoji} url={item.user.avatar}/> : ''}*/}\n        {/*            <LeftMsg i={index}*/}\n        {/*                     onIm={onIm}   //被选中im*/}\n        {/*                     omWord={(cd) => setWord(cd)}        //点击词典*/}\n        {/*                     onRecall={(im) => recallFun(im)}   //撤回消息*/}\n        {/*                     onSound={(i, im) => playSound(i, im)}*/}\n        {/*                     data={item}/>*/}\n        {/*        </View>)}*/}\n        {/*    <View style={{height: 70}}></View>*/}\n        {/*</ScrollView>*/}\n\n\n        {/*发送信息*/}\n        <View style={[styles.imSend]}>\n            {/*操作列表*/}\n            <View style={styles.imFun}>\n                <View style={user.column ? '' : {opacity: 0.3}}>\n                    <Btn text={'✍️'} fs={16} press={() =>member?_onColumn(!userRef.current.column, user =>{\n                        setUser(user)\n                        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)\n                    }) : alertMember('1')}/>\n                </View>\n                <View style={user.listen ? '' : {opacity: 0.3}}>\n                    <Btn text={'🎧️️'} fs={16} press={() =>member?_onListen(!userRef.current.listen, user => {\n                        setUser(user)\n                        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)\n                    }) : alertMember('2')}/>\n                </View>\n            </View>\n\n            {/*词列*/}\n            <View style={styles.imWord}>\n                {columnLi.map((item, index) =>\n                    <Text key={'iw' + index} style={styles.imWords}> {item} </Text>\n                )}\n            </View>\n\n            {/*发送消息*/}\n            <View style={[styles.imInput, C1, {paddingLeft: 10, paddingRight: 10}]}>\n                {/*选择图片发送*/}\n                <OssImage userID={user._id} cb={(url) => {\n                    let imData = {\n                        \"user\": user._id,\n                        \"list\": list,\n                        \"to\": to,\n                        \"url\": url,\n                        \"tIm\": 2\n                    }\n                    // console.log('发送图片', imData)\n                    socket.emit('im', imData)\n                }}/>\n                <TextInput value={input}\n                           multiline={true}\n                           style={[styles.imInputSend, styles.T5, MsgColor, MstText]}\n                           onFocus={({nativeEvent: {target}}) => {\n                               _ref.current.scrollToEnd({animated: true})\n                           }}   //调整位置\n                           onTextInput={({nativeEvent: {text, previousText, range: {start, end}}}) => {\n                               let reg = /[^\\u0000-\\u00FF]/\n                               //词裂功能\n                               if (reg.test(text.trim()) && user.column) {\n                                   console.log('词列', text)\n                                   _Column(text, cb => {\n                                       let columnArr = columnRef.current  //词列\n                                       columnArr.push(cb)\n                                       Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)\n                                       setColumnLi([...columnArr])\n                                   })\n                               }\n                               //重制词列\n                               if (start == 0) {\n                                   console.log('重置词列')\n                                   setColumnLi([...[]])\n                               }\n                           }}\n                           onChangeText={text => setInput(text)}/>\n                {input.length ? <TouchableOpacity onPress={() => {\n                        setInput('')\n                        let imData = {\n                            \"user\": user._id,\n                            \"list\": list,\n                            \"to\": to,\n                            \"listen\": user.listen ? true : false,\n                            \"q\": input,\n                            \"tIm\": 1\n                        }\n                        socket.emit('im', imData)\n                    }}>\n                        <Text style={styles.imSendBtn}>发送</Text>\n                    </TouchableOpacity> :\n                    <Record userID={user._id} start={() => {\n                        // 开始录音\n                        setAudioLoad(true)\n                        _interval.current = setInterval(() => {\n                            setSeconds(seconds => seconds + 1);\n                        }, 1000);\n                    }} stop={(ell) => {\n                        // 停止录音\n                        setAudioLoad(false)\n                        setSeconds(1)\n                        clearInterval(_interval.current)\n                    }} cb={(url) => {\n                        let imData = {\n                            \"user\": user._id,\n                            \"list\": list,\n                            \"to\": to,\n                            \"url\": url,\n                            \"q\": seconds,\n                            \"tIm\": 3\n                        }\n                        // console.log('发送声音', url, imData)\n                        socket.emit('im', imData)\n                    }}/>}\n\n            </View>\n        </View>\n    </View>\n}\n\n// 左边信息\nfunction LeftMsg(props) {\n    const {onIm, onSound, data, i, omWord, onRecall} = props\n    const colorScheme = useColorScheme();\n    const MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg  //对话框配色\n    const MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52'    //点击对话框\n    const MstText = colorScheme == 'light' ? {color: '#222222'} : {color: '#ffffff'}    //对话框颜色\n    const lightNsgBcB = colorScheme == 'light' ? styles.lightNsgBcB : styles.darkNsgBcB    //对话框分割线\n    const window = useWindowDimensions();\n    const [show, setShow] = useState(false) //操作键\n\n    switch (data.tIm) {\n        case 1:\n            return <View style={[styles.msgRow]}>\n                <View style={[{flexDirection: \"row\", alignItems: \"center\"}]}>\n                    <TouchableOpacity style={[styles.msgText, {maxWidth: (0.6 * window.width)}, MsgColor]}\n                                      onPress={() => onSound(i, data)} onLongPress={() => {\n                        setShow(true)\n                        setTimeout(() => {\n                            setShow(false)\n                        }, 3000)\n                    }}>\n                        <Text style={[styles.T5, MstText, styles.en, {opacity: 0.8}]}>{data.q}</Text>\n                        <Text style={[styles.T6, MstText, styles.en, {opacity: 0.8}]}>{data.enQ}</Text>\n                    </TouchableOpacity>\n                    {i == onIm ? <TouchableHighlight activeOpacity={0.3} underlayColor={MsgColorTouchable}>\n                        <Text style={[styles.msgAudio, styles.T6]}> 🎵</Text>\n                    </TouchableHighlight> : ''}\n                </View>\n                {show ? <View style={[styles.flot, MsgColor]}>\n\n                    {data.word.length ? <TouchableOpacity onPress={() => omWord(data.word)}>\n                        <Text style={[MstText, styles.flotText]}> 词典 </Text>\n                    </TouchableOpacity> : ''}\n                    {data.word.length ? <View style={[styles.flotHx, lightNsgBcB]}></View> : ''}\n\n                    <TouchableOpacity onPress={() => {\n                        _addStore({\n                            url: data.url,\n                            tIm: 1,\n                            word: data.word,\n                            user: data.user._id,\n                            q: data.q,\n                            enQ: data.enQ\n                        })\n                        setShow(false)\n                    }}>\n                        <Text style={[styles.flotText, MstText]}>收藏 </Text>\n                    </TouchableOpacity>\n                    <View style={[styles.flotHx, lightNsgBcB]}></View>\n                    <TouchableOpacity onPress={async () => {\n                        await Clipboard.setStringAsync(data.enQ)\n                        setShow(false)\n                    }}>\n                        <Text style={[styles.flotText, MstText]}>复制译文</Text>\n                    </TouchableOpacity>\n                </View> : ''}\n            </View>\n            break;\n        case 2:\n            return <TouchableHighlight style={[styles.msgRow]}>\n                <MsgImg url={data.url}/>\n            </TouchableHighlight>\n            break;\n        case 3:\n            return <View style={[styles.msgRow, {flexDirection: \"row\", alignItems: \"center\"}]}>\n                <TouchableOpacity style={[styles.msgText, {width: data.q < 20 ? 20 + (data.q * 10) : 100}, MsgColor]}\n                                  onPress={() => onSound(i, data)}>\n                    <Text style={[styles.T5, MstText, styles.en, {opacity: 0.8}]}>{data.q} \"</Text>\n                </TouchableOpacity>\n                {i == onIm ? <Text style={[styles.msgAudio, styles.T6]}> 🎵</Text> : ''}\n            </View>\n            break;\n        case 4:\n            return <Text style={[styles.time, MstText, {width: window.width, opacity: 0.3}]}>{timeIm(data.q)}</Text>\n            break\n    }\n}\n\n// 右边信息\nfunction RightMsg(props) {\n    const {onIm, data, i, onSound, omWord, onRecall} = props\n    const colorScheme = useColorScheme();\n    const MstText = colorScheme == 'light' ? {color: '#222222'} : {color: '#ffffff'}    //对话框颜色\n    const MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52'    //点击对话框\n    const lightNsgBcB = colorScheme == 'light' ? styles.lightNsgBcB : styles.darkNsgBcB    //对话框分割线\n    const window = useWindowDimensions();\n\n    const [show, setShow] = useState(false)\n\n\n    switch (data.tIm) {\n        case 1:\n            return <View style={[styles.msgRowRight]}>\n                <View style={[{flexDirection: \"row\", alignItems: \"center\"}]}>\n                    {i == onIm ? <TouchableHighlight>\n                        <Text style={[styles.msgAudio, styles.T6]}> 🎵</Text>\n                    </TouchableHighlight> : ''}\n                    <TouchableOpacity\n                        style={[styles.msgText, {backgroundColor: '#5A8DFF', maxWidth: (0.6 * window.width)}]}\n                        onPress={() => onSound(i, data)} onLongPress={() => {\n                        setShow(true)\n                        setTimeout(() => {\n                            setShow(false)\n                        }, 3000)\n                    }}>\n                        <Text style={[styles.T5, {color: \"#fff\"}]}>{data.q}</Text>\n                        <Text style={[styles.T6, styles.en, {color: \"#fff\"}, {opacity: 0.8}]}>{data.enQ}</Text>\n                    </TouchableOpacity>\n                </View>\n                {show ? <View style={[styles.flot, {backgroundColor: '#5A8DFF'}]}>\n                    {data.word.length ? <TouchableOpacity onPress={() => omWord(data.word)}>\n                        <Text style={[{color: \"#fff\"}, styles.flotText]}> 词典 </Text>\n                    </TouchableOpacity> : ''}\n                    {data.word.length ? <View style={[styles.flotHx, {backgroundColor: '#EAEAEA'}]}></View> : \"\"}\n                    <TouchableOpacity onPress={() => {\n                        _addStore({\n                            url: data.url,\n                            tIm: 1,\n                            word: data.word,\n                            user: data.user._id,\n                            q: data.q,\n                            enQ: data.enQ\n                        })\n                        setShow(false)\n                    }}>\n                        <Text style={[{color: \"#fff\"}, styles.flotText]}> 收藏 </Text>\n                    </TouchableOpacity>\n\n                    <View style={[styles.flotHx, {backgroundColor: '#EAEAEA'}]}></View>\n                    <TouchableOpacity onPress={async () => {\n                        await Clipboard.setStringAsync(data.enQ)\n                        setShow(false)\n                    }}>\n                        <Text style={[{color: \"#fff\"}, styles.flotText]}> 复制译文</Text>\n                    </TouchableOpacity>\n\n                    <View style={[styles.flotHx, {backgroundColor: '#EAEAEA'}]}></View>\n                    <TouchableOpacity onPress={() => Alert.alert('撤回消息', '一旦撤回将永不可见', [\n                        {\n                            text: '确定',\n                            onPress: () => onRecall(data._id)\n                        },\n                        {\n                            text: '取消',\n                            onPress: () => setShow(false)\n                        }\n                    ])}>\n                        <Text style={[{color: \"#fff\"}, styles.flotText]}> 撤回 </Text>\n                    </TouchableOpacity>\n\n                </View> : ''}\n            </View>\n            break;\n        case 2:\n            return <View style={[styles.msgRowRight]}>\n                <TouchableHighlight onLongPress={() => Alert.alert('撤回这张图片', '消息撤回后，将不可见', [\n                    {\n                        text: \"确定\",\n                        onPress: () => onRecall(data._id)\n                    },\n                    {\n                        text: \"取消\"\n                    }\n                ])}>\n                    <MsgImg url={data.url}/>\n                </TouchableHighlight>\n            </View>\n            break;\n        case 3:\n            return <View style={[styles.msgRowRight, {flexDirection: \"row\", alignItems: \"center\"}]}>\n                {i == onIm ? <Text style={[styles.msgAudio, styles.T6]}> 🎵</Text> : ''}\n\n                <TouchableOpacity style={[styles.msgText, {\n                    backgroundColor: '#5A8DFF',\n                    width: data.q < 20 ? 20 + (data.q * 10) : 100\n                }]}\n                                  onPress={() => onSound(i, data)}\n                                  onLongPress={() => Alert.alert('撤回语音', '消息撤回后，将不可见', [\n                                      {\n                                          text: \"确定\",\n                                          onPress: () => onRecall(data._id)\n                                      },\n                                      {\n                                          text: \"取消\"\n                                      }\n                                  ])}>\n                    <Text style={[styles.T5, styles.en, {\n                        color: \"#fff\",\n                        opacity: 0.8,\n                        width: data.q < 20 ? 20 + (data.q * 10) : 100\n                    }]}> {data.q} \"</Text>\n                </TouchableOpacity>\n            </View>\n            break;\n        case 4:\n            return <Text style={[styles.time, MstText, {width: window.width, opacity: 0.3}]}>{timeIm(data.q)}</Text>\n            break\n    }\n}\n\n\n//图像裁切\nfunction MsgImg(props) {\n    const [w, setW] = useState(200)\n    const [h, setH] = useState(200)\n\n    const window = useWindowDimensions();\n    useEffect(() => {\n        Image.getSize(props.url, (w, h) => {\n            let maxWidth = window.width * 0.7\n            // console.log(maxWidth, '像素', window.width, w, maxWidth / w, h)\n            if (window.width < w) {\n                setH(h * (maxWidth / w))\n                setW(maxWidth)\n            } else {\n                setH(h)\n                setW(w)\n            }\n        })\n    }, [])\n\n    return <Image\n        style={[{width: w, height: h, borderRadius: 5}]}\n        source={{\n            uri: props.url,\n        }}\n    />\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}