{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport axios from \"axios\";\nimport { useState } from \"react\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { Btn } from \"../component/btn\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar url = 'https://boatlmtext.oss-cn-guangzhou.aliyuncs.com/';\n\nexport var OssImage = function OssImage(props) {\n  var userID = props.userID,\n    cb = props.cb;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    load = _useState2[0],\n    setLoad = _useState2[1];\n\n  var upImg = function upImg() {\n    setLoad(true);\n    var imgName = userID + Math.random().toString(36).substring(2);\n    ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.All,\n      quality: 0.5\n    }).then(function (res) {\n      if (res.cancelled) {\n        setLoad(false);\n      } else {\n        var formData = new FormData();\n        console.log('选择图片', res);\n        var data = {\n          uri: res.uri,\n          type: \"image/jpeg\"\n        };\n        formData.append('key', \"img/\" + imgName + \".png\");\n        formData.append('OSSAccessKeyId', 'LTAI7KYTQrVQf2gD');\n        formData.append('signature', 'R2kloMky67ZNHiATW3E8J6PYnGc=');\n        formData.append('policy', 'eyJleHBpcmF0aW9uIjoiMjAyMy0wMS0wMVQxMjowMDowMC4wMDBaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDAsMTA0ODU3NjAwMF1dfQ==');\n        formData.append('success_action_status', 201);\n        formData.append('file', data);\n        axios.post(url, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        }).then(function (res) {\n          console.log('上传图片', res.data);\n          cb(\"https://boatlmtext.oss-cn-guangzhou.aliyuncs.com/img/\" + imgName + \".png\");\n          setLoad(false);\n        }, function (err) {\n          console.log('上传图片失败', err);\n          setLoad(false);\n        });\n      }\n    });\n  };\n  return _jsx(View, {\n    children: load ? _jsx(ActivityIndicator, {}) : _jsx(Btn, {\n      text: '📷️',\n      fs: 20,\n      press: function press() {\n        return upImg();\n      }\n    })\n  });\n};","map":{"version":3,"names":["ImagePicker","axios","useState","Btn","url","OssImage","props","userID","cb","load","setLoad","upImg","imgName","Math","random","toString","substring","launchImageLibraryAsync","mediaTypes","MediaTypeOptions","All","quality","then","res","cancelled","formData","FormData","console","log","data","uri","type","append","post","headers","err"],"sources":["/Users/hez/code/boatApp/src/utils/oss.js"],"sourcesContent":["import * as ImagePicker from \"expo-image-picker\";\nimport axios from \"axios\";\nimport {useState} from \"react\";\nimport {ActivityIndicator, View} from \"react-native\";\nimport {Btn} from \"../component/btn\";\n\nlet url='https://boatlmtext.oss-cn-guangzhou.aliyuncs.com/'\n// let url = 'http://192.168.0.101:3000/uploads'\n\nexport const OssImage = (props) => {\n    const {userID,cb} = props\n    const [load, setLoad] = useState(false)     //加载动画、\n\n    const upImg = ()=>{\n        setLoad(true)\n        let imgName = userID+Math.random().toString(36).substring(2);\n        ImagePicker.launchImageLibraryAsync({\n            mediaTypes: ImagePicker.MediaTypeOptions.All,\n            // allowsEditing: true,\n            // aspect: [4, 3],\n            quality: 0.5,\n        }).then(res => {\n            if(res.cancelled){  //取消选择图\n                setLoad(false)\n            }else {\n                const formData = new FormData()\n                console.log('选择图片', res)\n                let data = {\n                    uri : res.uri,\n                    type: \"image/jpeg\"\n                }\n                formData.append('key', `img/${imgName}.png`)\n                formData.append('OSSAccessKeyId', 'LTAI7KYTQrVQf2gD')\n                formData.append('signature', 'R2kloMky67ZNHiATW3E8J6PYnGc=')\n                formData.append('policy', 'eyJleHBpcmF0aW9uIjoiMjAyMy0wMS0wMVQxMjowMDowMC4wMDBaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDAsMTA0ODU3NjAwMF1dfQ==')\n                formData.append('success_action_status', 201)\n                formData.append('file',data)\n                axios.post(url, formData,{\n                    headers:{\n                        'Content-Type': 'multipart/form-data'\n                    }\n                }).then(res => {\n                    console.log('上传图片', res.data)\n                    cb(`https://boatlmtext.oss-cn-guangzhou.aliyuncs.com/img/${imgName}.png`)\n                    setLoad(false)\n                }, err => {\n                    console.log('上传图片失败', err)\n                    setLoad(false)\n                })\n            }\n        });\n    }\n\n    return <View>\n        {load?<ActivityIndicator/>:<Btn  text={'📷️'} fs={20} press={()=>upImg() } />}\n    </View>\n\n}\n"],"mappings":";AAAA,OAAO,KAAKA,WAAW,MAAM,mBAAmB;AAChD,OAAOC,KAAK,MAAM,OAAO;AACzB,SAAQC,QAAQ,QAAO,OAAO;AAAC;AAAA;AAE/B,SAAQC,GAAG;AAA0B;AAErC,IAAIC,GAAG,GAAC,mDAAmD;;AAG3D,OAAO,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,CAAIC,KAAK,EAAK;EAC/B,IAAOC,MAAM,GAAOD,KAAK,CAAlBC,MAAM;IAACC,EAAE,GAAIF,KAAK,CAAXE,EAAE;EAChB,gBAAwBN,QAAQ,CAAC,KAAK,CAAC;IAAA;IAAhCO,IAAI;IAAEC,OAAO;;EAEpB,IAAMC,KAAK,GAAG,SAARA,KAAK,GAAO;IACdD,OAAO,CAAC,IAAI,CAAC;IACb,IAAIE,OAAO,GAAGL,MAAM,GAACM,IAAI,CAACC,MAAM,EAAE,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC;IAC5DhB,WAAW,CAACiB,uBAAuB,CAAC;MAChCC,UAAU,EAAElB,WAAW,CAACmB,gBAAgB,CAACC,GAAG;MAG5CC,OAAO,EAAE;IACb,CAAC,CAAC,CAACC,IAAI,CAAC,UAAAC,GAAG,EAAI;MACX,IAAGA,GAAG,CAACC,SAAS,EAAC;QACbd,OAAO,CAAC,KAAK,CAAC;MAClB,CAAC,MAAK;QACF,IAAMe,QAAQ,GAAG,IAAIC,QAAQ,EAAE;QAC/BC,OAAO,CAACC,GAAG,CAAC,MAAM,EAAEL,GAAG,CAAC;QACxB,IAAIM,IAAI,GAAG;UACPC,GAAG,EAAGP,GAAG,CAACO,GAAG;UACbC,IAAI,EAAE;QACV,CAAC;QACDN,QAAQ,CAACO,MAAM,CAAC,KAAK,WAASpB,OAAO,UAAO;QAC5Ca,QAAQ,CAACO,MAAM,CAAC,gBAAgB,EAAE,kBAAkB,CAAC;QACrDP,QAAQ,CAACO,MAAM,CAAC,WAAW,EAAE,8BAA8B,CAAC;QAC5DP,QAAQ,CAACO,MAAM,CAAC,QAAQ,EAAE,kIAAkI,CAAC;QAC7JP,QAAQ,CAACO,MAAM,CAAC,uBAAuB,EAAE,GAAG,CAAC;QAC7CP,QAAQ,CAACO,MAAM,CAAC,MAAM,EAACH,IAAI,CAAC;QAC5B5B,KAAK,CAACgC,IAAI,CAAC7B,GAAG,EAAEqB,QAAQ,EAAC;UACrBS,OAAO,EAAC;YACJ,cAAc,EAAE;UACpB;QACJ,CAAC,CAAC,CAACZ,IAAI,CAAC,UAAAC,GAAG,EAAI;UACXI,OAAO,CAACC,GAAG,CAAC,MAAM,EAAEL,GAAG,CAACM,IAAI,CAAC;UAC7BrB,EAAE,2DAAyDI,OAAO,UAAO;UACzEF,OAAO,CAAC,KAAK,CAAC;QAClB,CAAC,EAAE,UAAAyB,GAAG,EAAI;UACNR,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEO,GAAG,CAAC;UAC1BzB,OAAO,CAAC,KAAK,CAAC;QAClB,CAAC,CAAC;MACN;IACJ,CAAC,CAAC;EACN,CAAC;EAED,OAAO,KAAC,IAAI;IAAA,UACPD,IAAI,GAAC,KAAC,iBAAiB,KAAE,GAAC,KAAC,GAAG;MAAE,IAAI,EAAE,KAAM;MAAC,EAAE,EAAE,EAAG;MAAC,KAAK,EAAE;QAAA,OAAIE,KAAK,EAAE;MAAA;IAAE;EAAG,EAC1E;AAEX,CAAC"},"metadata":{},"sourceType":"module"}