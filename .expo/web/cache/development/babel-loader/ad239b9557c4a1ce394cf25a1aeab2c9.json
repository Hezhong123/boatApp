{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Pressable from \"react-native-web/dist/exports/Pressable\";\nimport RefreshControl from \"react-native-web/dist/exports/RefreshControl\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport TouchableHighlight from \"react-native-web/dist/exports/TouchableHighlight\";\nimport useColorScheme from \"react-native-web/dist/exports/useColorScheme\";\nimport useWindowDimensions from \"react-native-web/dist/exports/useWindowDimensions\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { Component, useEffect, useRef, useState } from \"react\";\nimport * as React from \"react\";\nimport { styles } from \"../css\";\nimport { Portrait } from \"../component/Portrait\";\nimport { Btn, Click, TextClick } from \"../component/btn\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { _addStore, _Column, _Msg, _onColumn, _onListen, _Unread, _User } from \"../_Api\";\nimport { io } from \"socket.io-client\";\nimport { OssImage, pickImage } from \"../utils/oss\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { Record } from \"../utils/record\";\nimport { Audio } from 'expo-av';\nimport { timeIm } from \"../utils/time\";\nimport KeyboardAvoidingView from \"react-native/Libraries/Components/Keyboard/KeyboardAvoidingView\";\nvar socket = io('ws://192.168.0.100:3000');\nvar host = 'http://192.168.0.100:3000/audio/';\nimport * as Clipboard from 'expo-clipboard';\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport function Im(_ref2) {\n  var route = _ref2.route,\n    navigation = _ref2.navigation;\n  var colorScheme = useColorScheme();\n\n  var _route$params = route.params,\n    list = _route$params.list,\n    name = _route$params.name,\n    to = _route$params.to,\n    unread = _route$params.unread;\n  var C1 = colorScheme == 'light' ? styles.lightC1 : styles.darkC1;\n  var MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg;\n  var MstText = colorScheme == 'light' ? {\n    color: '#222222'\n  } : {\n    color: '#ffffff'\n  };\n\n  var _useState = useState({}),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var userRef = useRef(user);\n  userRef.current = user;\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    input = _useState4[0],\n    setInput = _useState4[1];\n  var _useState5 = useState(),\n    _useState6 = _slicedToArray(_useState5, 2),\n    audioLoad = _useState6[0],\n    setAudioLoad = _useState6[1];\n  var _useState7 = useState(),\n    _useState8 = _slicedToArray(_useState7, 2),\n    sounds = _useState8[0],\n    setSound = _useState8[1];\n  var _useState9 = useState(1),\n    _useState10 = _slicedToArray(_useState9, 2),\n    seconds = _useState10[0],\n    setSeconds = _useState10[1];\n  var _useState11 = useState(0),\n    _useState12 = _slicedToArray(_useState11, 2),\n    imi = _useState12[0],\n    setImi = _useState12[1];\n  var msgIm = useRef(imi);\n  msgIm.current = imi;\n  var _useState13 = useState([]),\n    _useState14 = _slicedToArray(_useState13, 2),\n    columnLi = _useState14[0],\n    setColumnLi = _useState14[1];\n\n  var columnRef = useRef(columnLi);\n  columnRef.current = columnLi;\n  var _ref = useRef(null);\n  var _useState15 = useState([]),\n    _useState16 = _slicedToArray(_useState15, 2),\n    msgArr = _useState16[0],\n    setMsgArr = _useState16[1];\n  var msgRef = useRef(msgArr);\n  msgRef.current = msgArr;\n  var _interval = useRef();\n  var window = useWindowDimensions();\n\n  var _useState17 = useState(null),\n    _useState18 = _slicedToArray(_useState17, 2),\n    soundIndex = _useState18[0],\n    setSoundIndex = _useState18[1];\n  function onPlaySound(_x) {\n    return _onPlaySound.apply(this, arguments);\n  }\n  function _onPlaySound() {\n    _onPlaySound = _asyncToGenerator(function* (url) {\n      var _yield$Audio$Sound$cr = yield Audio.Sound.createAsync({\n          uri: url\n        }),\n        sound = _yield$Audio$Sound$cr.sound;\n      setSound(sound);\n      console.log('Playing Sound');\n      yield sound.playAsync();\n    });\n    return _onPlaySound.apply(this, arguments);\n  }\n  useEffect(function () {\n    return sounds ? function () {\n      console.log('Unloading Sound');\n      sounds.unloadAsync();\n    } : undefined;\n  }, [sounds]);\n\n  useFocusEffect(React.useCallback(function () {\n    console.log(\"\\u8FDB\\u5165im\\uFF0C\\u4FE1\\u9053: \" + list + \", \" + to);\n    navigation.setOptions({\n      title: name\n    });\n\n    _User(function (cb) {\n      return setUser(cb);\n    });\n\n    socket.on(list, function (im) {\n      var arr = msgRef.current;\n      arr.push(im);\n      console.log('im:', arr.length, im);\n      setMsgArr(_toConsumableArray(arr));\n      setTimeout(function () {\n        return _ref.current.scrollToEnd({\n          animated: true\n        });\n      }, 100);\n\n      if (userRef.current.listen && im.url != 'null') {\n        onPlaySound(host + im.url);\n        setImi(arr.length - 1);\n      }\n    });\n\n    _Msg(list, function (cd) {\n      console.log('ÊªöÂä®ÂØπËØù„ÄÅ„ÄÅ', cd);\n      setMsgArr(cd);\n      cd.length ? setTimeout(function () {\n        return _ref.current.scrollToEnd({\n          animated: true\n        });\n      }, 100) : '';\n    });\n    return function () {\n      var msgSlice = msgRef.current.length ? msgRef.current[msgRef.current.length - 1] : {\n        tIm: 4\n      };\n      console.log('Á¶ªÂºÄim,Êñ≠ÂºÄÈìæÊé•', msgSlice.tIm);\n      if (msgSlice.tIm != 4) {\n        var time = new Date();\n        var imData = {\n          \"user\": userRef.current._id,\n          \"list\": list,\n          \"to\": to,\n          \"q\": time,\n          \"tIm\": 4\n        };\n        socket.emit('im', imData);\n        console.log('Êõ¥Êñ∞Êó∂Èó¥Êà≥', user._id);\n      }\n      socket.off(list);\n      if (unread) {\n        _Unread(list, userRef.current._id);\n      }\n    };\n  }, []));\n\n  var _useState19 = useState(false),\n    _useState20 = _slicedToArray(_useState19, 2),\n    load = _useState20[0],\n    setLoad = _useState20[1];\n  var onRefresh = function onRefresh(e) {\n    setLoad(true);\n    console.log('‰∏ãÊãâËÆ∞ËΩΩÂØπËØùÂÜÖÂÆπ', e);\n    setTimeout(function () {\n      setLoad(false);\n    }, 600);\n  };\n  return _jsxs(View, {\n    style: [C1, styles.Im],\n    children: [audioLoad ? _jsx(View, {\n      style: [styles.audioModel, {\n        height: window.height\n      }],\n      children: _jsxs(View, {\n        style: [styles.audioBody, MsgColor],\n        children: [_jsxs(Text, {\n          style: [styles.T1, MstText, {\n            fontWeight: '600'\n          }],\n          children: [seconds, \" \\\"\"]\n        }), _jsx(Text, {\n          style: [styles.T5, styles.Send, MstText, {\n            marginTop: 5\n          }],\n          children: \"\\u677E\\u624B\\u5373\\u53EF\\u53D1\\u9001\"\n        })]\n      })\n    }) : '', _jsxs(ScrollView, {\n      refreshing: true,\n      refreshControl: _jsx(RefreshControl, {\n        refreshing: load,\n        onRefresh: onRefresh\n      }),\n      keyboardDismissMode: \"on-drag\",\n      ref: _ref,\n      children: [msgArr.map(function (item, index) {\n        return item.user._id == user._id ? _jsx(RightMsg, {\n          tIm: item.tIm,\n          audio: onPlaySound,\n          i: index,\n          imIndex: imi,\n          onIndex: function onIndex(i) {\n          },\n          data: item\n        }, 'msg' + index) : _jsxs(View, {\n          style: styles.ImMsg,\n          children: [item.tIm != 4 ? _jsx(Portrait, {\n            w: 32,\n            h: 32,\n            r: 7,\n            t: item.user.emoji,\n            url: item.user.avatar\n          }) : '', _jsx(LeftMsg, {\n            tIm: item.tIm,\n            i: index,\n            audio: onPlaySound,\n            imIndex: imi,\n            onIndex: function onIndex(i) {\n            },\n            data: item\n          })]\n        }, 'msg' + index);\n      }), _jsx(View, {\n        style: {\n          height: 70\n        }\n      })]\n    }), _jsxs(KeyboardAvoidingView, {\n      style: [styles.imSend],\n      children: [_jsxs(View, {\n        style: styles.imFun,\n        children: [_jsx(View, {\n          style: user.column ? '' : {\n            opacity: 0.3\n          },\n          children: _jsx(Btn, {\n            text: '‚úçÔ∏è',\n            fs: 16,\n            press: function press() {\n              return _onColumn(!user.column, function (user) {\n                return setUser(user);\n              });\n            }\n          })\n        }), _jsx(View, {\n          style: user.listen ? '' : {\n            opacity: 0.3\n          },\n          children: _jsx(Btn, {\n            text: 'üéßÔ∏èÔ∏è',\n            fs: 16,\n            press: function press() {\n              return _onListen(!user.listen, function (user) {\n                return setUser(user);\n              });\n            }\n          })\n        })]\n      }), _jsx(View, {\n        style: styles.imWord,\n        children: columnLi.map(function (item, index) {\n          return _jsxs(Text, {\n            style: styles.imWords,\n            children: [\" \", item, \" \"]\n          }, 'iw' + index);\n        })\n      }), _jsxs(View, {\n        style: [styles.imInput, C1, {\n          paddingLeft: 10,\n          paddingRight: 10\n        }],\n        children: [_jsx(OssImage, {\n          userID: user._id,\n          cb: function cb(url) {\n            var imData = {\n              \"user\": user._id,\n              \"list\": list,\n              \"to\": to,\n              \"url\": url,\n              \"tIm\": 2\n            };\n            console.log('ÂèëÈÄÅÂõæÁâá', imData);\n            socket.emit('im', imData);\n          }\n        }), _jsx(TextInput, {\n          value: input,\n          style: [styles.imInputSend, styles.T5, MsgColor, MstText],\n          onTextInput: function onTextInput(_ref3) {\n            var _ref3$nativeEvent = _ref3.nativeEvent,\n              text = _ref3$nativeEvent.text,\n              previousText = _ref3$nativeEvent.previousText,\n              _ref3$nativeEvent$ran = _ref3$nativeEvent.range,\n              start = _ref3$nativeEvent$ran.start,\n              end = _ref3$nativeEvent$ran.end;\n            var reg = /[^\\u0000-\\u00FF]/;\n            if (reg.test(text.trim()) && user.column) {\n              console.log('text', text);\n              _Column(text, function (cb) {\n                var columnArr = columnRef.current;\n                columnArr.push(cb);\n                setColumnLi(_toConsumableArray(columnArr));\n              });\n            }\n\n            if (start == 0) {\n              console.log('ÈáçÁΩÆËØçÂàó');\n              setColumnLi([].concat());\n            }\n          },\n          onChangeText: function onChangeText(text) {\n            return setInput(text);\n          },\n          multiline: true\n        }), input.length ? _jsx(Btn, {\n          text: 'üí¨Ô∏è',\n          fs: 20,\n          press: function press() {\n            setInput('');\n            var imData = {\n              \"user\": user._id,\n              \"list\": list,\n              \"to\": to,\n              \"listen\": user.listen ? true : false,\n              \"q\": input,\n              \"tIm\": 1\n            };\n            console.log('ËæìÂÖ•‰ø°ÊÅØ', imData);\n            socket.emit('im', imData);\n          }\n        }) : _jsx(Record, {\n          userID: user._id,\n          start: function start() {\n            setAudioLoad(true);\n            setSeconds(0);\n            _interval.current = setInterval(function () {\n              setSeconds(function (seconds) {\n                return seconds + 1;\n              });\n            }, 1000);\n          },\n          stop: function stop(ell) {\n            setAudioLoad(false);\n            clearInterval(_interval.current);\n          },\n          cb: function cb(url) {\n            var imData = {\n              \"user\": user._id,\n              \"list\": list,\n              \"to\": to,\n              \"url\": url,\n              \"q\": seconds,\n              \"tIm\": 3\n            };\n            console.log('ÂèëÈÄÅÂ£∞Èü≥', url, imData);\n            socket.emit('im', imData);\n          }\n        })]\n      })]\n    })]\n  });\n}\n\nfunction LeftMsg(props) {\n  var tIm = props.tIm,\n    data = props.data,\n    i = props.i,\n    imIndex = props.imIndex,\n    onIndex = props.onIndex;\n  var colorScheme = useColorScheme();\n  var MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg;\n  var MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52';\n  var MstText = colorScheme == 'light' ? {\n    color: '#222222'\n  } : {\n    color: '#ffffff'\n  };\n  var lightNsgBcB = colorScheme == 'light' ? styles.lightNsgBcB : styles.darkNsgBcB;\n  var window = useWindowDimensions();\n  switch (tIm) {\n    case 1:\n      return _jsxs(View, {\n        style: [styles.msgRow],\n        children: [_jsxs(View, {\n          style: [styles.msgText, {\n            maxWidth: 0.6 * window.width\n          }, MsgColor],\n          children: [_jsxs(Text, {\n            style: [styles.T5, MstText, styles.en, {\n              opacity: 0.8\n            }],\n            children: [\" \", data.q]\n          }), _jsx(TextClick, {\n            click: function click() {\n              return onIndex(i);\n            },\n            doubleClick: function doubleClick() {\n              return Alert.alert(\"ËØëÊñáÊìç‰Ωú\", \"Êî∂ËóèÁöÑËØëÊñáÂ∞ÜÂú®ÊàëÁöÑÔºåÈïøÊåâÂèØ‰ª•Âà†Èô§\", [{\n                text: \"Êî∂Ëóè\",\n                onPress: function onPress() {\n                  return _addStore({\n                    url: data.url,\n                    tIm: tIm,\n                    user: data.user._id,\n                    q: data.q,\n                    to: data.to,\n                    enQ: data.enQ\n                  });\n                }\n              }, {\n                text: \"Â§çÂà∂\",\n                onPress: function () {\n                  var _onPress = _asyncToGenerator(function* () {\n                    return yield Clipboard.setStringAsync(data.enQ);\n                  });\n                  function onPress() {\n                    return _onPress.apply(this, arguments);\n                  }\n                  return onPress;\n                }()\n              }, {\n                text: \"ÂèñÊ∂à\",\n                onPress: function () {\n                  var _onPress2 = _asyncToGenerator(function* () {\n                    return yield Clipboard.setStringAsync('');\n                  });\n                  function onPress() {\n                    return _onPress2.apply(this, arguments);\n                  }\n                  return onPress;\n                }()\n              }]);\n            },\n            press: function press() {\n              return Alert.alert(\"Âà†Èô§Ê∂àÊÅØ\", \"\", [{\n                text: \"Á°ÆÂÆö\",\n                onPress: function onPress() {\n                  return console.log('Êí§ÂõûÊ∂àÊÅØ');\n                }\n              }]);\n            },\n            slot: _jsx(Text, {\n              style: [styles.T6, MstText, styles.en, {\n                opacity: 0.8\n              }],\n              children: data.enQ\n            })\n          })]\n        }), i == imIndex ? _jsx(TouchableHighlight, {\n          activeOpacity: 0.3,\n          underlayColor: MsgColorTouchable,\n          children: _jsx(Text, {\n            style: [styles.msgAudio, styles.T6],\n            children: \" \\uD83C\\uDFB5\"\n          })\n        }) : '']\n      });\n      break;\n    case 2:\n      return _jsx(View, {\n        style: [styles.msgRow],\n        children: _jsx(TouchableHighlight, {\n          activeOpacity: 0.5,\n          underlayColor: MsgColorTouchable,\n          onPress: function onPress() {},\n          children: _jsx(MsgImg, {\n            url: data.url\n          })\n        })\n      });\n      break;\n    case 3:\n      return _jsxs(View, {\n        style: [styles.msgRow],\n        children: [_jsx(TouchableHighlight, {\n          style: [styles.msgText, MsgColor],\n          activeOpacity: 0.3,\n          onPress: function onPress() {\n            return onIndex(i);\n          },\n          underlayColor: MsgColorTouchable,\n          children: _jsxs(Text, {\n            style: [styles.T5, styles.en, MstText, {\n              width: data.q < 20 ? 20 + data.q * 10 : 100\n            }],\n            children: [\" \", data.q, \" \\\"\"]\n          })\n        }), i == imIndex ? _jsx(TouchableHighlight, {\n          activeOpacity: 0.3,\n          underlayColor: MsgColorTouchable,\n          children: _jsx(Text, {\n            style: [styles.msgAudio, styles.T6],\n            children: \" \\uD83C\\uDFB5\"\n          })\n        }) : '']\n      });\n      break;\n    case 4:\n      return _jsx(View, {\n        children: _jsx(Text, {\n          style: [styles.time, MstText, {\n            width: window.width,\n            opacity: 0.3\n          }],\n          children: timeIm(data.q)\n        })\n      });\n      break;\n  }\n}\n\nfunction RightMsg(props) {\n  var tIm = props.tIm,\n    data = props.data,\n    i = props.i,\n    imIndex = props.imIndex,\n    onIndex = props.onIndex;\n  var colorScheme = useColorScheme();\n  var MstText = colorScheme == 'light' ? {\n    color: '#222222'\n  } : {\n    color: '#ffffff'\n  };\n  var MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52';\n  var window = useWindowDimensions();\n  switch (tIm) {\n    case 1:\n      return _jsxs(View, {\n        style: [styles.msgRowRight],\n        children: [i == imIndex ? _jsx(TouchableHighlight, {\n          children: _jsx(Text, {\n            style: [styles.msgAudio, styles.T6],\n            children: \" \\uD83C\\uDFB5\"\n          })\n        }) : '', _jsxs(View, {\n          style: [styles.msgText, {\n            backgroundColor: '#5A8DFF',\n            maxWidth: 0.6 * window.width\n          }],\n          children: [_jsx(Text, {\n            style: [styles.T5, styles.zh, {\n              color: \"#fff\"\n            }],\n            children: data.q\n          }), _jsx(TextClick, {\n            click: function click() {\n              return onIndex(i);\n            },\n            doubleClick: function doubleClick() {\n              return Alert.alert(\"Â§çÂà∂ËØëÊñáÂà∞Ââ™ÂàáÊùø\", \"\", [{\n                text: \"Êî∂Ëóè\",\n                onPress: function onPress() {\n                  return _addStore({\n                    url: data.url,\n                    tIm: tIm,\n                    user: data.user._id,\n                    q: data.q,\n                    enQ: data.enQ\n                  });\n                }\n              }, {\n                text: \"Â§çÂà∂\",\n                onPress: function () {\n                  var _onPress3 = _asyncToGenerator(function* () {\n                    return yield Clipboard.setStringAsync(data.enQ);\n                  });\n                  function onPress() {\n                    return _onPress3.apply(this, arguments);\n                  }\n                  return onPress;\n                }()\n              }, {\n                text: \"ÂèñÊ∂à\",\n                onPress: function () {\n                  var _onPress4 = _asyncToGenerator(function* () {\n                    return yield Clipboard.setStringAsync('');\n                  });\n                  function onPress() {\n                    return _onPress4.apply(this, arguments);\n                  }\n                  return onPress;\n                }()\n              }]);\n            },\n            press: function press() {\n              return Alert.alert(\"Êí§ÂõûÊ∂àÊÅØ\", \"\", [{\n                text: \"Á°ÆÂÆö\",\n                onPress: function onPress() {\n                  return console.log('Êí§ÂõûÊ∂àÊÅØ');\n                }\n              }]);\n            },\n            slot: _jsxs(Text, {\n              style: [styles.T6, styles.en, {\n                color: \"#fff\"\n              }, {\n                opacity: 0.8\n              }],\n              children: [\" \", data.enQ]\n            })\n          })]\n        })]\n      });\n      break;\n    case 2:\n      return _jsx(View, {\n        style: [styles.msgRowRight],\n        children: _jsx(TouchableHighlight, {\n          underlayColor: MsgColorTouchable,\n          activeOpacity: 0.5,\n          onPress: function onPress() {},\n          children: _jsx(MsgImg, {\n            url: data.url\n          })\n        })\n      });\n      break;\n    case 3:\n      return _jsxs(View, {\n        style: [styles.msgRowRight],\n        children: [i == imIndex ? _jsx(TouchableHighlight, {\n          children: _jsx(Text, {\n            style: [styles.msgAudio, styles.T6],\n            children: \" \\uD83C\\uDFB5\"\n          })\n        }) : '', _jsx(View, {\n          style: [styles.msgText, {\n            backgroundColor: '#5A8DFF'\n          }],\n          children: _jsx(TouchableHighlight, {\n            underlayColor: '#5A8DFF',\n            onPress: function onPress() {\n              return onIndex(i);\n            },\n            children: _jsxs(Text, {\n              style: [styles.T5, styles.en, {\n                color: \"#fff\",\n                opacity: 0.8,\n                width: data.q < 20 ? 20 + data.q * 10 : 100\n              }],\n              children: [\" \", data.q, \" \\\"\"]\n            })\n          })\n        })]\n      });\n      break;\n    case 4:\n      return _jsx(View, {\n        children: _jsx(Text, {\n          style: [styles.time, MstText, {\n            width: window.width,\n            opacity: 0.3\n          }],\n          children: timeIm(data.q)\n        })\n      });\n      break;\n  }\n}\n\nfunction MsgImg(props) {\n  var _useState21 = useState(200),\n    _useState22 = _slicedToArray(_useState21, 2),\n    w = _useState22[0],\n    setW = _useState22[1];\n  var _useState23 = useState(200),\n    _useState24 = _slicedToArray(_useState23, 2),\n    h = _useState24[0],\n    setH = _useState24[1];\n  var window = useWindowDimensions();\n  useEffect(function () {\n    Image.getSize(props.url, function (w, h) {\n      var maxWidth = window.width * 0.7;\n      console.log(maxWidth, 'ÂÉèÁ¥†', window.width, w, maxWidth / w, h);\n      if (window.width < w) {\n        setH(h * (maxWidth / w));\n        setW(maxWidth);\n      } else {\n        setH(h);\n        setW(w);\n      }\n    });\n  }, []);\n  return _jsx(Image, {\n    style: [{\n      width: w,\n      height: h,\n      borderRadius: 5\n    }],\n    source: {\n      uri: props.url\n    }\n  });\n}","map":{"version":3,"names":["Component","useEffect","useRef","useState","React","styles","Portrait","Btn","Click","TextClick","useFocusEffect","_addStore","_Column","_Msg","_onColumn","_onListen","_Unread","_User","io","OssImage","pickImage","ImagePicker","Record","Audio","timeIm","KeyboardAvoidingView","socket","host","Clipboard","Im","route","navigation","colorScheme","useColorScheme","params","list","name","to","unread","C1","lightC1","darkC1","MsgColor","lightMsg","darkMsg","MstText","color","user","setUser","userRef","current","input","setInput","audioLoad","setAudioLoad","sounds","setSound","seconds","setSeconds","imi","setImi","msgIm","columnLi","setColumnLi","columnRef","_ref","msgArr","setMsgArr","msgRef","_interval","window","useWindowDimensions","soundIndex","setSoundIndex","onPlaySound","url","Sound","createAsync","uri","sound","console","log","playAsync","unloadAsync","undefined","useCallback","setOptions","title","cb","on","im","arr","push","length","setTimeout","scrollToEnd","animated","listen","cd","msgSlice","tIm","time","Date","imData","_id","emit","off","load","setLoad","onRefresh","e","audioModel","height","audioBody","T1","fontWeight","T5","Send","marginTop","map","item","index","i","ImMsg","emoji","avatar","imSend","imFun","column","opacity","imWord","imWords","imInput","paddingLeft","paddingRight","imInputSend","nativeEvent","text","previousText","range","start","end","reg","test","trim","columnArr","setInterval","ell","clearInterval","LeftMsg","props","data","imIndex","onIndex","MsgColorTouchable","lightNsgBcB","darkNsgBcB","msgRow","msgText","maxWidth","width","en","q","Alert","alert","onPress","enQ","setStringAsync","T6","msgAudio","RightMsg","msgRowRight","backgroundColor","zh","MsgImg","w","setW","h","setH","Image","getSize","borderRadius"],"sources":["/Users/hez/code/boatApp/src/views/im.js"],"sourcesContent":["import {\n    ActivityIndicator, Alert,\n    Button, FlatList,\n    Image, Pressable, RefreshControl,\n    SafeAreaView,\n    ScrollView,\n    Text,\n    TextInput,\n    TouchableHighlight,\n    useColorScheme,\n    useWindowDimensions,\n    View\n} from \"react-native\";\nimport {Component, useEffect, useRef, useState} from \"react\";\nimport * as React from \"react\";\nimport {styles} from \"../css\";\nimport {Portrait} from \"../component/Portrait\";\nimport {Btn, Click, TextClick} from \"../component/btn\";\nimport {useFocusEffect} from \"@react-navigation/native\";\nimport {_addStore, _Column, _Msg, _onColumn, _onListen, _Unread, _User} from \"../_Api\";\nimport {io} from \"socket.io-client\";\nimport {OssImage, pickImage} from \"../utils/oss\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport {Record} from \"../utils/record\";\nimport {Audio} from 'expo-av';\nimport {timeIm} from \"../utils/time\";\nimport KeyboardAvoidingView from \"react-native/Libraries/Components/Keyboard/KeyboardAvoidingView\";\n\nconst socket = io('ws://192.168.0.100:3000')\nconst host = 'http://192.168.0.100:3000/audio/'\nimport * as Clipboard from 'expo-clipboard'\n\nexport function Im({route, navigation}) {\n    const colorScheme = useColorScheme();\n\n    // Ë∑ØÁî±ÂèÇÊï∞\n    const {list, name, to, unread} = route.params;\n\n    const C1 = colorScheme == 'light' ? styles.lightC1 : styles.darkC1\n    const MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg  //ÂØπËØùÊ°ÜÈÖçËâ≤\n    const MstText = colorScheme == 'light' ? {color: '#222222'} : {color: '#ffffff'}    //ÂØπËØùÊ°ÜÈ¢úËâ≤\n\n    const [user, setUser] = useState({}) //Áî®Êà∑‰ø°ÊÅØ\n    const userRef = useRef(user)\n    userRef.current = user\n\n    const [input, setInput] = useState('')  //ËæìÂÖ•‰ø°ÊÅØ\n    const [audioLoad, setAudioLoad] = useState()  //ÂΩïÂà∂Â£∞Èü≥\n    const [sounds, setSound] = useState();   // Êí≠ÊîæÂ£∞Èü≥\n    const [seconds, setSeconds] = useState(1)   //ËÆ°Êó∂Êó∂Èïø\n    const [imi, setImi] = useState(0)     //ÈÄâ‰∏≠È°πÁõÆ\n    const msgIm = useRef(imi)\n    msgIm.current = imi\n\n    const [columnLi, setColumnLi] = useState([]) //ËØçÂàó\n\n    const columnRef = useRef(columnLi)      //ËØçË£ÇÂ±ïÂºÄ\n    columnRef.current = columnLi\n\n    const _ref = useRef(null)           //ScrollView ÊéßÂà∂Âô®\n    const [msgArr, setMsgArr] = useState([])        //ÂØπËØùÂàóË°®\n    const msgRef = useRef(msgArr)\n    msgRef.current = msgArr\n\n\n    const _interval = useRef()  //ËÆ°Êó∂Âô®\n    const window = useWindowDimensions();\n\n    //Êí≠ÊîæÂ£∞Èü≥\n    const [soundIndex, setSoundIndex] = useState(null)  //Êí≠ÊîæÂ£∞Èü≥‰∏ãÊ†á\n    async function onPlaySound(url) {\n        const {sound} = await Audio.Sound.createAsync({uri: url});\n        setSound(sound);\n        console.log('Playing Sound');\n        await sound.playAsync();\n    }\n\n    //‰∏≠Êñ≠Â£∞Èü≥\n    useEffect(() => {\n        return sounds\n            ? () => {\n                console.log('Unloading Sound');\n                sounds.unloadAsync();\n            }\n            : undefined;\n    }, [sounds]);\n\n    // Ë∑ØÁî±ÁîüÂëΩÂë®Êúü\n    useFocusEffect(React.useCallback(() => {\n        console.log(`ËøõÂÖ•imÔºå‰ø°ÈÅì: ${list}, ${to}`)\n        navigation.setOptions({title: name})\n\n        //Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ\n        _User(cb => setUser(cb))\n\n        // Êé•Êî∂‰ø°ÊÅØ\n        socket.on(list, (im) => {\n            let arr = msgRef.current\n            arr.push(im)\n            console.log('im:', arr.length, im)\n            setMsgArr([...arr])\n            setTimeout(() => _ref.current.scrollToEnd({animated: true}), 100)\n\n            //Ë∑üËØª‰ø°Âè∑\n            if (userRef.current.listen && im.url != 'null') {\n                onPlaySound(host + im.url)\n                setImi(arr.length - 1)\n            }\n        });\n\n        // Âä†ËΩΩÂØπËØùÂÜÖÂÆπ\n        _Msg(list, cd => {\n            console.log('ÊªöÂä®ÂØπËØù„ÄÅ„ÄÅ', cd)\n            setMsgArr(cd)\n            cd.length ? setTimeout(() => _ref.current.scrollToEnd({animated: true}), 100) : ''\n\n        })\n\n        return () => {\n            // Êõ¥Êñ∞Êó∂Èó¥Êà≥\n            let msgSlice = msgRef.current.length ? msgRef.current[msgRef.current.length - 1] : {tIm: 4}\n            console.log('Á¶ªÂºÄim,Êñ≠ÂºÄÈìæÊé•', msgSlice.tIm)\n            if (msgSlice.tIm != 4) {\n                let time = new Date()\n                let imData = {\n                    \"user\": userRef.current._id,\n                    \"list\": list,\n                    \"to\": to,\n                    \"q\": time,\n                    \"tIm\": 4\n                }\n                socket.emit('im', imData)\n                console.log('Êõ¥Êñ∞Êó∂Èó¥Êà≥', user._id)\n            }\n            socket.off(list)\n            if (unread) {\n                _Unread(list, userRef.current._id)\n            }\n\n        }\n    }, []))\n\n    //‰∏ãÂï¶Âà∑Êñ∞\n    const [load, setLoad] = useState(false)\n    const onRefresh = (e) => {\n        setLoad(true)\n        console.log('‰∏ãÊãâËÆ∞ËΩΩÂØπËØùÂÜÖÂÆπ', e)\n        setTimeout(() => {\n            setLoad(false)\n        }, 600)\n    }\n\n\n    return <View style={[C1, styles.Im]}>\n\n        {/*ÂΩïÈü≥Êé®ÈÄÅ*/}\n        {audioLoad ? <View style={[styles.audioModel, {height: window.height}]}>\n            <View style={[styles.audioBody, MsgColor]}>\n                <Text style={[styles.T1, MstText, {fontWeight: '600'}]}>{seconds} \"</Text>\n                {/*<Image style={styles.audioIcon}  source={require('../img/audio.png')} />*/}\n                <Text style={[styles.T5, styles.Send, MstText, {marginTop: 5}]}>ÊùæÊâãÂç≥ÂèØÂèëÈÄÅ</Text>\n            </View>\n        </View> : ''}\n\n        {/*ÂØπËØùÂÜÖÂÆπ*/}\n        <ScrollView\n            refreshing={true}\n            refreshControl={<RefreshControl refreshing={load} onRefresh={onRefresh}/>}\n            keyboardDismissMode={\"on-drag\"}\n            ref={_ref}>\n            {msgArr.map((item, index) => item.user._id == user._id ?\n                // Ëá™Â∑±ÂèëÈÄÅ\n                <RightMsg key={'msg' + index}\n                          tIm={item.tIm}\n                          audio={onPlaySound}\n                          i={index}\n                          imIndex={imi}\n                          onIndex={i => {\n                              //Êí≠ÊîæËØëÊñá\n                              // msgArr[i].url != 'null' ? setImi(i) : setImi(null)\n                              // msgArr[i].url != 'null' ? onPlaySound(msgArr[i].tIm == 3 ? msgArr[i].url : host + msgArr[i].url) : ''\n                          }}\n                          data={item}/> :\n                // Âà´‰∫∫ÁöÑ\n                <View style={styles.ImMsg} key={'msg' + index}>\n                    {item.tIm != 4 ? <Portrait w={32} h={32} r={7} t={item.user.emoji} url={item.user.avatar}/> : ''}\n                    <LeftMsg tIm={item.tIm}\n                             i={index}\n                             audio={onPlaySound}\n                             imIndex={imi}\n                             onIndex={i => {\n                                 //Êí≠ÊîæËØëÊñá\n                                 // msgArr[i].url != 'null' ? setImi(i) : setImi(null)\n                                 // msgArr[i].url != 'null' ? onPlaySound(msgArr[i].tIm == 3 ? msgArr[i].url : host + msgArr[i].url) : ''\n                             }}\n                             data={item}/>\n                </View>)}\n            <View style={{height: 70}}></View>\n        </ScrollView>\n\n\n        {/*ÂèëÈÄÅ‰ø°ÊÅØ*/}\n        <KeyboardAvoidingView style={[styles.imSend]}>\n            {/*Êìç‰ΩúÂàóË°®*/}\n            <View style={styles.imFun}>\n                <View style={user.column ? '' : {opacity: 0.3}}>\n                    <Btn text={'‚úçÔ∏è'} fs={16} press={() => _onColumn(!user.column, user => setUser(user))}/>\n                </View>\n                <View style={user.listen ? '' : {opacity: 0.3}}>\n                    <Btn text={'üéßÔ∏èÔ∏è'} fs={16} press={() => _onListen(!user.listen, user => setUser(user))}/>\n                </View>\n\n            </View>\n\n            {/*ËØçÂàó*/}\n            <View style={styles.imWord}>\n                {columnLi.map((item, index) =>\n                    <Text key={'iw' + index} style={styles.imWords}> {item} </Text>\n                )}\n            </View>\n\n            {/*ÂèëÈÄÅÊ∂àÊÅØ*/}\n            <View style={[styles.imInput, C1, {paddingLeft: 10, paddingRight: 10}]}>\n                {/*ÈÄâÊã©ÂõæÁâáÂèëÈÄÅ*/}\n                <OssImage userID={user._id} cb={(url) => {\n                    let imData = {\n                        \"user\": user._id,\n                        \"list\": list,\n                        \"to\": to,\n                        \"url\": url,\n                        \"tIm\": 2\n                    }\n                    console.log('ÂèëÈÄÅÂõæÁâá', imData)\n                    socket.emit('im', imData)\n                }}/>\n                <TextInput value={input}\n                           style={[styles.imInputSend, styles.T5, MsgColor, MstText]}\n                           onTextInput={({nativeEvent: {text, previousText, range: {start, end}}}) => {\n                               // console.log('111',text,'new1:', previousText,'222',start,end)\n                               let reg = /[^\\u0000-\\u00FF]/\n                               //ËØçË£ÇÂäüËÉΩ\n                               if (reg.test(text.trim()) && user.column) {\n                                   console.log('text', text)\n                                   _Column(text, cb => {\n                                       let columnArr = columnRef.current  //ËØçÂàó\n                                       // console.log('111',cb)\n                                       columnArr.push(cb)\n                                       setColumnLi([...columnArr])\n                                   })\n                               }\n\n                               //ÈáçÂà∂ËØçÂàó\n                               if (start == 0) {\n                                   console.log('ÈáçÁΩÆËØçÂàó')\n                                   setColumnLi([...[]])\n                               }\n\n                           }}\n                           onChangeText={text => setInput(text)}\n                           multiline={true}/>\n                {input.length ? <Btn text={'üí¨Ô∏è'} fs={20} press={() => {\n                    setInput('')\n                    let imData = {\n                        \"user\": user._id,\n                        \"list\": list,\n                        \"to\": to,\n                        \"listen\": user.listen ? true : false,\n                        \"q\": input,\n                        \"tIm\": 1\n                    }\n                    console.log('ËæìÂÖ•‰ø°ÊÅØ', imData)\n                    socket.emit('im', imData)\n                }}/> : <Record userID={user._id} start={() => {\n                    //ÂºÄÂßãÂΩïÈü≥\n                    setAudioLoad(true)\n                    setSeconds(0)\n                    _interval.current = setInterval(() => {\n                        setSeconds(seconds => seconds + 1);\n                    }, 1000);\n                }} stop={(ell) => {\n                    // ÂÅúÊ≠¢ÂΩïÈü≥\n                    setAudioLoad(false)\n                    clearInterval(_interval.current)\n                }} cb={(url) => {\n                    let imData = {\n                        \"user\": user._id,\n                        \"list\": list,\n                        \"to\": to,\n                        \"url\": url,\n                        \"q\": seconds,\n                        \"tIm\": 3\n                    }\n                    console.log('ÂèëÈÄÅÂ£∞Èü≥', url, imData)\n                    socket.emit('im', imData)\n                }}/>}\n\n            </View>\n        </KeyboardAvoidingView>\n\n        {/*<Text> ÂèëÈÄÅÂØπËØùÈ°µÈù¢ </Text>*/}\n    </View>\n}\n\n\n// Âè≥Ëæπ‰ø°ÊÅØ\nfunction LeftMsg(props) {\n    const {tIm, data, i, imIndex, onIndex} = props\n    const colorScheme = useColorScheme();\n    const MsgColor = colorScheme == 'light' ? styles.lightMsg : styles.darkMsg  //ÂØπËØùÊ°ÜÈÖçËâ≤\n    const MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52'    //ÁÇπÂáªÂØπËØùÊ°Ü\n    const MstText = colorScheme == 'light' ? {color: '#222222'} : {color: '#ffffff'}    //ÂØπËØùÊ°ÜÈ¢úËâ≤\n    const lightNsgBcB = colorScheme == 'light' ? styles.lightNsgBcB : styles.darkNsgBcB    //ÂØπËØùÊ°ÜÂàÜÂâ≤Á∫ø\n    const window = useWindowDimensions();\n\n    switch (tIm) {\n        case 1:\n            return <View style={[styles.msgRow]}>\n                <View style={[styles.msgText, {maxWidth: (0.6 * window.width)}, MsgColor]}>\n                    <Text style={[styles.T5, MstText, styles.en, {opacity: 0.8}]}> {data.q}</Text>\n                    <TextClick click={() => onIndex(i)}\n                               doubleClick={() => Alert.alert(\"ËØëÊñáÊìç‰Ωú\", \"Êî∂ËóèÁöÑËØëÊñáÂ∞ÜÂú®ÊàëÁöÑÔºåÈïøÊåâÂèØ‰ª•Âà†Èô§\", [{\n                                   text: \"Êî∂Ëóè\",\n                                   onPress:() => _addStore({\n                                       url:data.url,\n                                       tIm:tIm,\n                                       user:data.user._id,\n                                       q:data.q,\n                                       to:data.to,\n                                       enQ:data.enQ\n                                   })\n                               }, {\n                                   text: \"Â§çÂà∂\",\n                                   onPress: async () => await Clipboard.setStringAsync(data.enQ)\n                               }, {\n                                   text: \"ÂèñÊ∂à\",\n                                   onPress: async () => await Clipboard.setStringAsync('')\n                               }])} press={() => Alert.alert(\"Âà†Èô§Ê∂àÊÅØ\", \"\", [{\n                        text: \"Á°ÆÂÆö\",\n                        onPress: () => console.log('Êí§ÂõûÊ∂àÊÅØ')\n                    }])} slot={\n                        <Text style={[styles.T6, MstText, styles.en, {opacity: 0.8}]}>{data.enQ}</Text>\n                    }/>\n                </View>\n                {i == imIndex ? <TouchableHighlight activeOpacity={0.3} underlayColor={MsgColorTouchable}>\n                    <Text style={[styles.msgAudio, styles.T6]}> üéµ</Text>\n                </TouchableHighlight> : ''}\n\n            </View>\n            break;\n        case 2:\n            return <View style={[styles.msgRow]}>\n                <TouchableHighlight activeOpacity={0.5}\n                                    underlayColor={MsgColorTouchable}\n                                    onPress={() => {\n                                    }}>\n                    <MsgImg url={data.url}/>\n                </TouchableHighlight>\n            </View>\n            break;\n        case 3:\n            return <View style={[styles.msgRow]}>\n                <TouchableHighlight style={[styles.msgText, MsgColor]} activeOpacity={0.3}\n                                    onPress={() => onIndex(i)}\n                                    underlayColor={MsgColorTouchable}>\n                    <Text\n                        style={[styles.T5, styles.en, MstText, {width: data.q < 20 ? 20 + (data.q * 10) : 100}]}> {data.q} \"</Text>\n                </TouchableHighlight>\n                {i == imIndex ? <TouchableHighlight activeOpacity={0.3} underlayColor={MsgColorTouchable}>\n                    <Text style={[styles.msgAudio, styles.T6]}> üéµ</Text>\n                </TouchableHighlight> : ''}\n            </View>\n            break;\n        case 4:\n            return <View>\n                <Text style={[styles.time, MstText, {width: window.width, opacity: 0.3}]}>{timeIm(data.q)}</Text>\n            </View>\n            break\n\n    }\n\n\n}\n\n// Â∑¶Ëæπ‰ø°ÊÅØ\nfunction RightMsg(props) {\n    const {tIm, data, i, imIndex, onIndex} = props\n    const colorScheme = useColorScheme();\n    const MstText = colorScheme == 'light' ? {color: '#222222'} : {color: '#ffffff'}    //ÂØπËØùÊ°ÜÈ¢úËâ≤\n    const MsgColorTouchable = colorScheme == 'light' ? '#EAEAEA' : '#333C52'    //ÁÇπÂáªÂØπËØùÊ°Ü\n    const window = useWindowDimensions();\n    switch (tIm) {\n        case 1:\n            return <View style={[styles.msgRowRight]}>\n                {i == imIndex ? <TouchableHighlight>\n                    <Text style={[styles.msgAudio, styles.T6]}> üéµ</Text>\n                </TouchableHighlight> : ''}\n                <View style={[styles.msgText, {backgroundColor: '#5A8DFF', maxWidth: (0.6 * window.width)}]}>\n                    <Text style={[styles.T5, styles.zh, {color: \"#fff\"}]}>{data.q}</Text>\n                    <TextClick click={() => onIndex(i)}\n                               doubleClick={() => Alert.alert(\"Â§çÂà∂ËØëÊñáÂà∞Ââ™ÂàáÊùø\", \"\", [{\n                                   text: \"Êî∂Ëóè\",\n                                   onPress:() =>  _addStore({\n                                       url:data.url,\n                                       tIm:tIm,\n                                       user:data.user._id,\n                                       q:data.q,\n                                       enQ:data.enQ\n                                   })\n                               }, {\n                                   text: \"Â§çÂà∂\",\n                                   onPress: async () => await Clipboard.setStringAsync(data.enQ)\n                               }, {\n                                   text: \"ÂèñÊ∂à\",\n                                   onPress: async () => await Clipboard.setStringAsync('')\n                               }])} press={() => Alert.alert(\"Êí§ÂõûÊ∂àÊÅØ\", \"\", [{\n                        text: \"Á°ÆÂÆö\",\n                        onPress: () => console.log('Êí§ÂõûÊ∂àÊÅØ')\n                    }])} slot={\n                        <Text style={[styles.T6, styles.en, {color: \"#fff\"}, {opacity: 0.8}]}> {data.enQ}</Text>\n                    }/>\n                </View>\n            </View>\n            break;\n        case 2:\n            return <View style={[styles.msgRowRight]}>\n                <TouchableHighlight underlayColor={MsgColorTouchable}\n                                    activeOpacity={0.5}\n                                    onPress={() => {\n                                    }}>\n                    <MsgImg url={data.url}/>\n                </TouchableHighlight>\n            </View>\n            break;\n        case 3:\n            return <View style={[styles.msgRowRight]}>\n                {i == imIndex ? <TouchableHighlight>\n                    <Text style={[styles.msgAudio, styles.T6]}> üéµ</Text>\n                </TouchableHighlight> : ''}\n                <View style={[styles.msgText, {backgroundColor: '#5A8DFF'}]}>\n                    <TouchableHighlight underlayColor={'#5A8DFF'} onPress={() => onIndex(i)}>\n                        <Text style={[styles.T5, styles.en, {\n                            color: \"#fff\",\n                            opacity: 0.8,\n                            width: data.q < 20 ? 20 + (data.q * 10) : 100\n                        }]}> {data.q} \"</Text>\n                    </TouchableHighlight>\n                </View>\n            </View>\n            break;\n        case 4:\n            return <View>\n                <Text style={[styles.time, MstText, {width: window.width, opacity: 0.3}]}>{timeIm(data.q)}</Text>\n            </View>\n            break\n    }\n}\n\n\n//ÂõæÂÉèË£ÅÂàá\nfunction MsgImg(props) {\n    const [w, setW] = useState(200)\n    const [h, setH] = useState(200)\n\n    const window = useWindowDimensions();\n    useEffect(() => {\n        Image.getSize(props.url, (w, h) => {\n            let maxWidth = window.width * 0.7\n            console.log(maxWidth, 'ÂÉèÁ¥†', window.width, w, maxWidth / w, h)\n            if (window.width < w) {\n                setH(h * (maxWidth / w))\n                setW(maxWidth)\n            } else {\n                setH(h)\n                setW(w)\n            }\n        })\n    }, [])\n\n    return <Image\n        style={[{width: w, height: h, borderRadius: 5}]}\n        source={{\n            uri: props.url,\n        }}\n    />\n}\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}